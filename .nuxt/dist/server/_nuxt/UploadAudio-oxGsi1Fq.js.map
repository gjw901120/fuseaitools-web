{"version":3,"file":"UploadAudio-oxGsi1Fq.js","sources":["../../../../components/tools/common/UploadAudio.vue"],"sourcesContent":["<template>\r\n  <div class=\"uploaded-audio\">\r\n    <!-- 上传区域 -->\r\n    <div class=\"upload-container\">\r\n      <input\r\n        :id=\"inputId\"\r\n        ref=\"fileInput\"\r\n        type=\"file\"\r\n        accept=\"audio/*\"\r\n        @change=\"handleFileChange\"\r\n        class=\"file-input\"\r\n      />\r\n      <div \r\n        class=\"upload-area\" \r\n        @click=\"triggerUpload\"\r\n      >\r\n        <div class=\"upload-content\">\r\n          <div class=\"upload-icon\">\r\n            <i :class=\"uploadIcon\"></i>\r\n          </div>\r\n          <div class=\"upload-text\">\r\n            <span class=\"upload-title\">{{ uploadText }}</span>\r\n            <small class=\"upload-subtitle\">{{ uploadHint }}</small>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 上传完成的音频展示区域 -->\r\n    <div v-if=\"uploadedFile\" class=\"uploaded-audio-display\">\r\n      <div class=\"audio-file-info\">\r\n        <i class=\"fas fa-file-audio audio-icon\"></i>\r\n        <div class=\"file-details\">\r\n          <span class=\"file-name\">{{ uploadedFile.name }}</span>\r\n          <span class=\"file-size\">{{ formatFileSize(uploadedFile.size) }}</span>\r\n        </div>\r\n        <button \r\n          type=\"button\"\r\n          @click=\"clearFile\"\r\n          class=\"remove-btn\"\r\n          title=\"删除文件\"\r\n        >\r\n          <i class=\"fas fa-times\"></i>\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- 音频播放控制 -->\r\n      <div class=\"audio-player\">\r\n        <button \r\n          type=\"button\"\r\n          @click=\"togglePlay\"\r\n          class=\"play-pause-btn\"\r\n          :class=\"{ playing: isPlaying }\"\r\n          :title=\"isPlaying ? '暂停' : '播放'\"\r\n        >\r\n          <i :class=\"isPlaying ? 'fas fa-pause' : 'fas fa-play'\"></i>\r\n        </button>\r\n        \r\n        <div class=\"progress-container\" @click=\"handleProgressClick\">\r\n          <div class=\"progress-bar\" :style=\"{ width: progress + '%' }\"></div>\r\n        </div>\r\n        \r\n        <span class=\"time-display\">{{ formatTime(currentTime) }} / {{ formatTime(duration) }}</span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 额外提示信息 -->\r\n    <div v-if=\"additionalHint\" class=\"additional-hint\">\r\n      {{ additionalHint }}\r\n    </div>\r\n\r\n    <!-- 隐藏的音频元素 -->\r\n    <audio \r\n      ref=\"audioPlayer\" \r\n      @timeupdate=\"handleTimeUpdate\" \r\n      @loadedmetadata=\"handleLoadedMetadata\" \r\n      @ended=\"handleEnded\"\r\n    ></audio>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onUnmounted } from 'vue'\r\n\r\nconst props = defineProps({\r\n  inputId: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  label: {\r\n    type: String,\r\n    default: '上传音频文件'\r\n  },\r\n  uploadIcon: {\r\n    type: String,\r\n    default: 'fas fa-cloud-upload-alt'\r\n  },\r\n  uploadText: {\r\n    type: String,\r\n    default: '点击上传音频文件'\r\n  },\r\n  uploadHint: {\r\n    type: String,\r\n    default: '支持 MP3, WAV, M4A 等格式'\r\n  },\r\n  additionalHint: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  themeColor: {\r\n    type: String,\r\n    default: '#10b981'\r\n  },\r\n  maxDuration: {\r\n    type: Number,\r\n    default: null // 最大时长（秒）\r\n  },\r\n  maxFileSize: {\r\n    type: Number,\r\n    default: 10 * 1024 * 1024 // 默认10MB\r\n  },\r\n  multiple: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['update:files'])\r\n\r\nconst fileInput = ref(null)\r\nconst audioPlayer = ref(null)\r\nconst uploadedFile = ref(null)\r\nconst isPlaying = ref(false)\r\nconst currentTime = ref(0)\r\nconst duration = ref(0)\r\n\r\nconst progress = computed(() => {\r\n  return duration.value > 0 ? (currentTime.value / duration.value) * 100 : 0\r\n})\r\n\r\nconst triggerUpload = () => {\r\n  fileInput.value?.click()\r\n}\r\n\r\nconst handleFileChange = (event) => {\r\n  const files = Array.from(event.target.files)\r\n  if (files.length > 0) {\r\n    const file = files[0] // 目前只处理第一个文件\r\n    validateAndSetFile(file)\r\n  }\r\n}\r\n\r\nconst validateAndSetFile = async (file) => {\r\n  // 检查文件类型\r\n  if (!file.type.startsWith('audio/')) {\r\n    alert('请选择音频文件')\r\n    return\r\n  }\r\n  \r\n  // 检查文件大小\r\n  if (file.size > props.maxFileSize) {\r\n    alert(`文件大小不能超过 ${formatFileSize(props.maxFileSize)}`)\r\n    return\r\n  }\r\n  \r\n  // 检查音频时长（如果设置了最大时长）\r\n  if (props.maxDuration) {\r\n    try {\r\n      const audioDuration = await getAudioDuration(file)\r\n      if (audioDuration > props.maxDuration) {\r\n        alert(`音频时长不能超过 ${props.maxDuration} 秒`)\r\n        return\r\n      }\r\n    } catch (error) {\r\n      console.warn('无法获取音频时长:', error)\r\n    }\r\n  }\r\n  \r\n  uploadedFile.value = file\r\n  if (audioPlayer.value) {\r\n    audioPlayer.value.src = URL.createObjectURL(file)\r\n    audioPlayer.value.load()\r\n  }\r\n  \r\n  // 重置播放状态\r\n  isPlaying.value = false\r\n  currentTime.value = 0\r\n  \r\n  emit('update:files', [file])\r\n}\r\n\r\nconst getAudioDuration = (file) => {\r\n  return new Promise((resolve, reject) => {\r\n    const audio = new Audio()\r\n    const url = URL.createObjectURL(file)\r\n    \r\n    audio.addEventListener('loadedmetadata', () => {\r\n      URL.revokeObjectURL(url)\r\n      resolve(audio.duration)\r\n    })\r\n    \r\n    audio.addEventListener('error', () => {\r\n      URL.revokeObjectURL(url)\r\n      reject(new Error('无法加载音频文件'))\r\n    })\r\n    \r\n    audio.src = url\r\n  })\r\n}\r\n\r\nconst togglePlay = () => {\r\n  if (!audioPlayer.value) return\r\n  \r\n  if (isPlaying.value) {\r\n    audioPlayer.value.pause()\r\n  } else {\r\n    audioPlayer.value.play()\r\n  }\r\n  isPlaying.value = !isPlaying.value\r\n}\r\n\r\nconst handleTimeUpdate = () => {\r\n  if (audioPlayer.value) {\r\n    currentTime.value = audioPlayer.value.currentTime\r\n  }\r\n}\r\n\r\nconst handleLoadedMetadata = () => {\r\n  if (audioPlayer.value) {\r\n    duration.value = audioPlayer.value.duration\r\n  }\r\n}\r\n\r\nconst handleEnded = () => {\r\n  isPlaying.value = false\r\n  currentTime.value = 0\r\n  if (audioPlayer.value) {\r\n    audioPlayer.value.currentTime = 0\r\n  }\r\n}\r\n\r\nconst handleProgressClick = (event) => {\r\n  if (!audioPlayer.value || duration.value === 0) return\r\n  \r\n  const progressBar = event.currentTarget\r\n  const clickX = event.clientX - progressBar.getBoundingClientRect().left\r\n  const newTime = (clickX / progressBar.offsetWidth) * duration.value\r\n  \r\n  audioPlayer.value.currentTime = newTime\r\n  currentTime.value = newTime\r\n}\r\n\r\nconst clearFile = () => {\r\n  // 停止播放\r\n  if (audioPlayer.value) {\r\n    audioPlayer.value.pause()\r\n    audioPlayer.value.currentTime = 0\r\n    audioPlayer.value.src = ''\r\n  }\r\n  \r\n  uploadedFile.value = null\r\n  isPlaying.value = false\r\n  currentTime.value = 0\r\n  duration.value = 0\r\n  \r\n  if (fileInput.value) {\r\n    fileInput.value.value = ''\r\n  }\r\n  \r\n  emit('update:files', [])\r\n}\r\n\r\nconst formatFileSize = (bytes) => {\r\n  if (bytes === 0) return '0 Bytes'\r\n  const k = 1024\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB']\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\r\n}\r\n\r\nconst formatTime = (seconds) => {\r\n  if (isNaN(seconds)) return '0:00'\r\n  const mins = Math.floor(seconds / 60)\r\n  const secs = Math.floor(seconds % 60)\r\n  return `${mins}:${secs.toString().padStart(2, '0')}`\r\n}\r\n\r\n// 组件卸载时清理资源\r\nonUnmounted(() => {\r\n  if (uploadedFile.value && audioPlayer.value && audioPlayer.value.src) {\r\n    URL.revokeObjectURL(audioPlayer.value.src)\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.uploaded-audio {\r\n  width: 100%;\r\n}\r\n\r\n.upload-container {\r\n  position: relative;\r\n}\r\n\r\n.file-input {\r\n  position: absolute;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n}\r\n\r\n.upload-area {\r\n  border: 2px dashed #e2e8f0;\r\n  border-radius: 8px;\r\n  padding: 12px 16px;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  background: #f8fafc;\r\n  min-height: 48px;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.upload-area:hover {\r\n  border-color: v-bind(themeColor);\r\n  background: rgba(16, 185, 129, 0.05);\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.upload-content {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  width: 100%;\r\n}\r\n\r\n.upload-icon {\r\n  width: 32px;\r\n  height: 32px;\r\n  border-radius: 50%;\r\n  background: v-bind(themeColor);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: white;\r\n  font-size: 14px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.upload-text {\r\n  flex: 1;\r\n  text-align: left;\r\n}\r\n\r\n.upload-title {\r\n  display: block;\r\n  font-size: 13px;\r\n  font-weight: 600;\r\n  color: #374151;\r\n  margin: 0 0 2px 0;\r\n}\r\n\r\n.upload-subtitle {\r\n  display: block;\r\n  font-size: 11px;\r\n  color: #64748b;\r\n  margin: 0;\r\n}\r\n\r\n/* 上传完成的音频展示区域 */\r\n.uploaded-audio-display {\r\n  margin-top: 12px;\r\n  border: 1px solid #e2e8f0;\r\n  border-radius: 8px;\r\n  background: white;\r\n  overflow: hidden;\r\n}\r\n\r\n.audio-file-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  padding: 12px 16px;\r\n  background: #f8fafc;\r\n  border-bottom: 1px solid #e2e8f0;\r\n}\r\n\r\n.audio-icon {\r\n  font-size: 18px;\r\n  color: v-bind(themeColor);\r\n  flex-shrink: 0;\r\n}\r\n\r\n.file-details {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 2px;\r\n}\r\n\r\n.file-name {\r\n  font-size: 13px;\r\n  font-weight: 500;\r\n  color: #374151;\r\n  word-break: break-all;\r\n}\r\n\r\n.file-size {\r\n  font-size: 11px;\r\n  color: #64748b;\r\n}\r\n\r\n.remove-btn {\r\n  width: 24px;\r\n  height: 24px;\r\n  border: none;\r\n  background: #ef4444;\r\n  color: white;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-shrink: 0;\r\n  font-size: 10px;\r\n}\r\n\r\n.remove-btn:hover {\r\n  background: #dc2626;\r\n}\r\n\r\n/* 音频播放控制 */\r\n.audio-player {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  padding: 12px 16px;\r\n}\r\n\r\n.play-pause-btn {\r\n  width: 32px;\r\n  height: 32px;\r\n  border: none;\r\n  background: v-bind(themeColor);\r\n  color: white;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-shrink: 0;\r\n  font-size: 12px;\r\n}\r\n\r\n.play-pause-btn:hover {\r\n  background: v-bind(themeColor);\r\n  opacity: 0.8;\r\n}\r\n\r\n.play-pause-btn.playing {\r\n  background: #ef4444;\r\n}\r\n\r\n.play-pause-btn.playing:hover {\r\n  background: #dc2626;\r\n}\r\n\r\n.progress-container {\r\n  flex: 1;\r\n  height: 4px;\r\n  background: #e2e8f0;\r\n  border-radius: 2px;\r\n  cursor: pointer;\r\n  position: relative;\r\n}\r\n\r\n.progress-bar {\r\n  height: 100%;\r\n  background: v-bind(themeColor);\r\n  border-radius: 2px;\r\n}\r\n\r\n.time-display {\r\n  font-size: 11px;\r\n  color: #64748b;\r\n  font-family: monospace;\r\n  flex-shrink: 0;\r\n  min-width: 80px;\r\n  text-align: right;\r\n}\r\n\r\n.additional-hint {\r\n  margin-top: 8px;\r\n  font-size: 12px;\r\n  color: #64748b;\r\n  line-height: 1.4;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .upload-area {\r\n    padding: 10px 14px;\r\n    min-height: 44px;\r\n  }\r\n  \r\n  .upload-icon {\r\n    width: 28px;\r\n    height: 28px;\r\n    font-size: 12px;\r\n  }\r\n  \r\n  .upload-title {\r\n    font-size: 12px;\r\n  }\r\n  \r\n  .upload-subtitle {\r\n    font-size: 10px;\r\n  }\r\n  \r\n  .audio-file-info {\r\n    padding: 10px 14px;\r\n  }\r\n  \r\n  .audio-icon {\r\n    font-size: 16px;\r\n  }\r\n  \r\n  .file-name {\r\n    font-size: 12px;\r\n  }\r\n  \r\n  .file-size {\r\n    font-size: 10px;\r\n  }\r\n  \r\n  .remove-btn {\r\n    width: 22px;\r\n    height: 22px;\r\n    font-size: 9px;\r\n  }\r\n  \r\n  .audio-player {\r\n    padding: 10px 14px;\r\n    gap: 10px;\r\n  }\r\n  \r\n  .play-pause-btn {\r\n    width: 28px;\r\n    height: 28px;\r\n    font-size: 11px;\r\n  }\r\n  \r\n  .time-display {\r\n    font-size: 10px;\r\n    min-width: 70px;\r\n  }\r\n}\r\n</style>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiIkB,QAAI,IAAI;AACN,QAAI,IAAI;AAC5B,UAAM,eAAe,IAAI,IAAI;AAC7B,UAAM,YAAY,IAAI,KAAK;AAC3B,UAAM,cAAc,IAAI,CAAC;AACzB,UAAM,WAAW,IAAI,CAAC;AAEtB,UAAM,WAAW,SAAS,MAAM;AAC9B,aAAO,SAAS,QAAQ,IAAK,YAAY,QAAQ,SAAS,QAAS,MAAM;AAAA,IAC3E,CAAC;AAsID,UAAM,iBAAiB,CAAC,UAAU;AAChC,UAAI,UAAU,EAAG,QAAO;AACxB,YAAM,IAAI;AACV,YAAM,QAAQ,CAAC,SAAS,MAAM,MAAM,IAAI;AACxC,YAAM,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC,CAAC;AAClD,aAAO,YAAY,QAAQ,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,MAAM,MAAM,CAAC;AAAA,IACxE;AAEA,UAAM,aAAa,CAAC,YAAY;AAC9B,UAAI,MAAM,OAAO,EAAG,QAAO;AAC3B,YAAM,OAAO,KAAK,MAAM,UAAU,EAAE;AACpC,YAAM,OAAO,KAAK,MAAM,UAAU,EAAE;AACpC,aAAO,GAAG,IAAI,IAAI,KAAK,SAAQ,EAAG,SAAS,GAAG,GAAG,CAAC;AAAA,IACpD;;;wBA7RqB,QAAA;AAAA;mBACdA,eAAAC,WAAA,EAAA,OAAM,iBAAgB,GAAA,QAAA,QAAA,CAAA,yEAIpBC,cAAA,MAAI,QAAA,OAAO,4NAaG,QAAA,UAAU,mIAGS,QAAA,UAAU,yEACN,QAAA,UAAU;UAOzC,aAAA,OAAY;gQAIUC,eAAA,aAAA,MAAa,IAAI,kEACjB,eAAe,aAAA,MAAa,IAAI,CAAA,oPAkBxC,UAAA,MAAS,GAAA,gBAAA,CAAA,KAC3BD,cAAA,SAAO,UAAA,QAAS,OAAA,IAAA,8CAEN,UAAA,QAAS,iBAAA,aAAA,4IAIuB,SAAA,QAAQ,IAAA,CAAA,6EAGvBC,eAAA,WAAW,YAAA,KAAW,CAAA,OAAUA,eAAA,WAAW,SAAA,KAAQ,CAAA;;;;UAK1E,QAAA,gBAAc;6EACpB,QAAA,cAAc,CAAA,QAAA;AAAA;;;;;;;;;;;;;;"}