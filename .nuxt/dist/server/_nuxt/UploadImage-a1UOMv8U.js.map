{"version":3,"file":"UploadImage-a1UOMv8U.js","sources":["../../../../components/tools/common/UploadImage.vue"],"sourcesContent":["<template>\r\n  <div class=\"uploaded-image\">\r\n    <div class=\"form-group\">\r\n      <label>{{ label }}</label>\r\n      <div class=\"file-upload-area\">\r\n        <input\r\n          :id=\"inputId\"\r\n          ref=\"fileInput\"\r\n          type=\"file\"\r\n          @change=\"handleFileChange\"\r\n          :accept=\"accept\"\r\n          :multiple=\"multiple\"\r\n          class=\"file-input\"\r\n        />\r\n        <label :for=\"inputId\" class=\"file-upload-label\">\r\n          <div class=\"upload-content\">\r\n            <i :class=\"uploadIcon\"></i>\r\n            <div class=\"upload-text\">\r\n              <span>{{ uploadText }}</span>\r\n              <small>{{ uploadHint }}</small>\r\n            </div>\r\n          </div>\r\n        </label>\r\n      </div>\r\n      \r\n      <!-- 已上传文件列表 -->\r\n        <div v-if=\"uploadedFiles.length > 0\" class=\"uploaded-files\">\r\n          <div v-for=\"(file, index) in uploadedFiles\" :key=\"index\" class=\"file-item\">\r\n            <div class=\"file-preview\" @click=\"isImage(file) ? previewImage(file) : null\" :class=\"{ 'clickable': isImage(file) }\">\r\n              <img v-if=\"isImage(file)\" :src=\"getFilePreview(file)\" :alt=\"file.name\" class=\"preview-image\" />\r\n              <i v-else :class=\"getFileIcon(file)\" class=\"file-icon\"></i>\r\n              <div v-if=\"isImage(file)\" class=\"preview-overlay\">\r\n                <i class=\"fas fa-eye\"></i>\r\n              </div>\r\n            </div>\r\n            <div class=\"file-info\">\r\n              <span class=\"file-name\">{{ file.name }}</span>\r\n              <span class=\"file-size\">{{ formatFileSize(file.size) }}</span>\r\n            </div>\r\n            <button type=\"button\" @click=\"removeFile(index)\" class=\"remove-file\">\r\n              <i class=\"fas fa-times\"></i>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      \r\n      <!-- 额外提示信息 -->\r\n      <div v-if=\"additionalHint\" class=\"additional-hint\">\r\n        {{ additionalHint }}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue'\r\n\r\nconst props = defineProps({\r\n  // 基础配置\r\n  inputId: {\r\n    type: String,\r\n    default: 'image-upload'\r\n  },\r\n  label: {\r\n    type: String,\r\n    default: '参考图片 (可选)'\r\n  },\r\n  \r\n  // 上传区域配置\r\n  uploadIcon: {\r\n    type: String,\r\n    default: 'fas fa-cloud-upload-alt'\r\n  },\r\n  uploadText: {\r\n    type: String,\r\n    default: '点击上传图片'\r\n  },\r\n  uploadHint: {\r\n    type: String,\r\n    default: '支持 .jfif, .jpeg, .jpg, .png, .webp (最多5张)'\r\n  },\r\n  \r\n  // 文件配置\r\n  accept: {\r\n    type: String,\r\n    default: '.jfif,.pjpeg,.jpeg,.pjp,.jpg,.png,.webp'\r\n  },\r\n  multiple: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  maxFiles: {\r\n    type: Number,\r\n    default: 5\r\n  },\r\n  maxFileSize: {\r\n    type: Number,\r\n    default: 10 * 1024 * 1024 // 10MB\r\n  },\r\n  \r\n  // 额外提示\r\n  additionalHint: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  \r\n  // 主题配置\r\n  themeColor: {\r\n    type: String,\r\n    default: '#6366f1'\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['update:files', 'file-added', 'file-removed'])\r\n\r\nconst fileInput = ref(null)\r\nconst uploadedFiles = ref([])\r\n\r\nconst handleFileChange = (event) => {\r\n  const files = Array.from(event.target.files)\r\n  if (files.length > 0) {\r\n    validateAndAddFiles(files)\r\n  }\r\n}\r\n\r\nconst validateAndAddFiles = (files) => {\r\n  const validFiles = []\r\n  \r\n  for (const file of files) {\r\n    // 检查文件数量限制\r\n    if (uploadedFiles.value.length + validFiles.length >= props.maxFiles) {\r\n      alert(`最多只能上传 ${props.maxFiles} 个文件`)\r\n      break\r\n    }\r\n    \r\n    // 检查文件大小\r\n    if (file.size > props.maxFileSize) {\r\n      alert(`文件 ${file.name} 大小不能超过 ${formatFileSize(props.maxFileSize)}`)\r\n      continue\r\n    }\r\n    \r\n    // 检查文件类型\r\n    if (!isFileTypeAccepted(file)) {\r\n      alert(`文件 ${file.name} 格式不支持`)\r\n      continue\r\n    }\r\n    \r\n    validFiles.push(file)\r\n  }\r\n  \r\n  if (validFiles.length > 0) {\r\n    if (props.multiple) {\r\n      uploadedFiles.value.push(...validFiles)\r\n    } else {\r\n      uploadedFiles.value = validFiles\r\n    }\r\n    // 统一 emit 数组，便于父组件一致处理（单文件时为 [file]）\r\n    const out = props.multiple ? [...uploadedFiles.value] : (uploadedFiles.value.length ? [uploadedFiles.value[0]] : [])\r\n    emit('update:files', out)\r\n    emit('file-added', validFiles)\r\n  }\r\n}\r\n\r\nconst isFileTypeAccepted = (file) => {\r\n  const acceptedTypes = props.accept.split(',').map(type => type.trim())\r\n  return acceptedTypes.some(type => {\r\n    if (type.startsWith('.')) {\r\n      // 检查文件扩展名\r\n      const extension = type.toLowerCase()\r\n      return file.name.toLowerCase().endsWith(extension)\r\n    } else if (type.endsWith('/*')) {\r\n      // 检查MIME类型前缀\r\n      const baseType = type.slice(0, -2)\r\n      return file.type.startsWith(baseType)\r\n    }\r\n    return file.type === type\r\n  })\r\n}\r\n\r\nconst isImage = (file) => {\r\n  return file.type.startsWith('image/')\r\n}\r\n\r\nconst getFilePreview = (file) => {\r\n  return URL.createObjectURL(file)\r\n}\r\n\r\nconst getFileIcon = (file) => {\r\n  if (file.type.startsWith('image/')) {\r\n    return 'fas fa-image'\r\n  } else if (file.type.startsWith('video/')) {\r\n    return 'fas fa-video'\r\n  } else if (file.type.startsWith('audio/')) {\r\n    return 'fas fa-file-audio'\r\n  } else {\r\n    return 'fas fa-file'\r\n  }\r\n}\r\n\r\nconst removeFile = (index) => {\r\n  const removedFile = uploadedFiles.value[index]\r\n  uploadedFiles.value.splice(index, 1)\r\n  const out = props.multiple ? [...uploadedFiles.value] : (uploadedFiles.value.length ? [uploadedFiles.value[0]] : [])\r\n  emit('update:files', out)\r\n  emit('file-removed', removedFile)\r\n}\r\n\r\nconst clearFiles = () => {\r\n  uploadedFiles.value = []\r\n  if (fileInput.value) {\r\n    fileInput.value.value = ''\r\n  }\r\n  emit('update:files', [])\r\n}\r\n\r\nconst formatFileSize = (bytes) => {\r\n  if (bytes === 0) return '0 Bytes'\r\n  const k = 1024\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB']\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\r\n}\r\n\r\nconst previewImage = (file) => {\r\n  const url = URL.createObjectURL(file)\r\n  \r\n  // 创建预览模态框\r\n  const modal = document.createElement('div')\r\n  modal.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.8);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 9999;\r\n    cursor: pointer;\r\n  `\r\n  \r\n  const img = document.createElement('img')\r\n  img.src = url\r\n  img.style.cssText = `\r\n    max-width: 90%;\r\n    max-height: 90%;\r\n    object-fit: contain;\r\n    border-radius: 8px;\r\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\r\n  `\r\n  \r\n  const closeBtn = document.createElement('div')\r\n  closeBtn.style.cssText = `\r\n    position: absolute;\r\n    top: 20px;\r\n    right: 20px;\r\n    width: 40px;\r\n    height: 40px;\r\n    background: rgba(255, 255, 255, 0.9);\r\n    border-radius: 50%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    font-size: 18px;\r\n    color: #333;\r\n  `\r\n  closeBtn.innerHTML = '×'\r\n  \r\n  modal.appendChild(img)\r\n  modal.appendChild(closeBtn)\r\n  document.body.appendChild(modal)\r\n  \r\n  // 点击关闭\r\n  const closeModal = () => {\r\n    document.body.removeChild(modal)\r\n    URL.revokeObjectURL(url)\r\n  }\r\n  \r\n  modal.addEventListener('click', closeModal)\r\n  closeBtn.addEventListener('click', (e) => {\r\n    e.stopPropagation()\r\n    closeModal()\r\n  })\r\n  \r\n  // ESC键关闭\r\n  const handleKeydown = (e) => {\r\n    if (e.key === 'Escape') {\r\n      closeModal()\r\n      document.removeEventListener('keydown', handleKeydown)\r\n    }\r\n  }\r\n  document.addEventListener('keydown', handleKeydown)\r\n}\r\n\r\n// 暴露方法给父组件\r\ndefineExpose({\r\n  clearFiles,\r\n  triggerUpload: () => fileInput.value?.click()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.uploaded-image {\r\n  width: 100%;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: #374151;\r\n}\r\n\r\n.file-upload-area {\r\n  position: relative;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.file-input {\r\n  position: absolute;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n}\r\n\r\n.file-upload-label {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 12px 16px;\r\n  border: 2px dashed #e2e8f0;\r\n  border-radius: 8px;\r\n  background: #f8fafc;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  min-height: 42px;\r\n}\r\n\r\n.file-upload-label:hover {\r\n  border-color: v-bind(themeColor);\r\n  background: rgba(99, 102, 241, 0.05);\r\n  transform: translateY(-1px);\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.upload-content {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.file-upload-label i {\r\n  font-size: 16px;\r\n  color: v-bind(themeColor);\r\n  flex-shrink: 0;\r\n}\r\n\r\n.upload-text {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  gap: 1px;\r\n}\r\n\r\n.file-upload-label span {\r\n  font-size: 13px;\r\n  font-weight: 500;\r\n  color: #374151;\r\n}\r\n\r\n.file-upload-label small {\r\n  font-size: 10px;\r\n  color: #64748b;\r\n}\r\n\r\n.uploaded-files {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n}\r\n\r\n.file-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  padding: 12px;\r\n  background: white;\r\n  border: 1px solid #e2e8f0;\r\n  border-radius: 8px;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.file-item:hover {\r\n  border-color: v-bind(themeColor);\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.file-preview {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 6px;\r\n  overflow: hidden;\r\n  flex-shrink: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: #f8fafc;\r\n  position: relative;\r\n}\r\n\r\n.file-preview.clickable {\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.file-preview.clickable:hover {\r\n  transform: scale(1.05);\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.preview-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.file-icon {\r\n  font-size: 20px;\r\n  color: v-bind(themeColor);\r\n}\r\n\r\n.preview-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  transition: opacity 0.2s ease;\r\n}\r\n\r\n.file-preview.clickable:hover .preview-overlay {\r\n  opacity: 1;\r\n}\r\n\r\n.preview-overlay i {\r\n  color: white;\r\n  font-size: 14px;\r\n}\r\n\r\n.file-info {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 2px;\r\n}\r\n\r\n.file-name {\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: #374151;\r\n  word-break: break-all;\r\n}\r\n\r\n.file-size {\r\n  font-size: 12px;\r\n  color: #64748b;\r\n}\r\n\r\n.remove-file {\r\n  width: 28px;\r\n  height: 28px;\r\n  border: none;\r\n  background: #ef4444;\r\n  color: white;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.remove-file:hover {\r\n  background: #dc2626;\r\n  transform: scale(1.1);\r\n}\r\n\r\n.additional-hint {\r\n  margin-top: 8px;\r\n  font-size: 12px;\r\n  color: #64748b;\r\n  line-height: 1.4;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .file-upload-label {\r\n    padding: 10px 14px;\r\n    min-height: 36px;\r\n  }\r\n  \r\n  .upload-content {\r\n    gap: 8px;\r\n  }\r\n  \r\n  .file-upload-label i {\r\n    font-size: 14px;\r\n  }\r\n  \r\n  .file-upload-label span {\r\n    font-size: 12px;\r\n  }\r\n  \r\n  .file-upload-label small {\r\n    font-size: 9px;\r\n  }\r\n  \r\n  .file-item {\r\n    padding: 8px;\r\n  }\r\n  \r\n  .file-preview {\r\n    width: 32px;\r\n    height: 32px;\r\n  }\r\n  \r\n  .file-icon {\r\n    font-size: 16px;\r\n  }\r\n  \r\n  .file-name {\r\n    font-size: 13px;\r\n  }\r\n  \r\n  .file-size {\r\n    font-size: 11px;\r\n  }\r\n  \r\n  .remove-file {\r\n    width: 24px;\r\n    height: 24px;\r\n  }\r\n}\r\n\r\n/* 多文件网格布局 */\r\n@media (min-width: 768px) {\r\n  .uploaded-files {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\r\n    gap: 12px;\r\n  }\r\n}\r\n</style>\r\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_ssrRenderClass","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgHA,UAAM,OAAO;AAEb,UAAM,YAAY,IAAI,IAAI;AAC1B,UAAM,gBAAgB,IAAI,EAAE;AA+D5B,UAAM,UAAU,CAAC,SAAS;AACxB,aAAO,KAAK,KAAK,WAAW,QAAQ;AAAA,IACtC;AAEA,UAAM,iBAAiB,CAAC,SAAS;AAC/B,aAAO,IAAI,gBAAgB,IAAI;AAAA,IACjC;AAEA,UAAM,cAAc,CAAC,SAAS;AAC5B,UAAI,KAAK,KAAK,WAAW,QAAQ,GAAG;AAClC,eAAO;AAAA,MACT,WAAW,KAAK,KAAK,WAAW,QAAQ,GAAG;AACzC,eAAO;AAAA,MACT,WAAW,KAAK,KAAK,WAAW,QAAQ,GAAG;AACzC,eAAO;AAAA,MACT,OAAO;AACL,eAAO;AAAA,MACT;AAAA,IACF;AAUA,UAAM,aAAa,MAAM;AACvB,oBAAc,QAAQ,CAAA;AACtB,UAAI,UAAU,OAAO;AACnB,kBAAU,MAAM,QAAQ;AAAA,MAC1B;AACA,WAAK,gBAAgB,EAAE;AAAA,IACzB;AAEA,UAAM,iBAAiB,CAAC,UAAU;AAChC,UAAI,UAAU,EAAG,QAAO;AACxB,YAAM,IAAI;AACV,YAAM,QAAQ,CAAC,SAAS,MAAM,MAAM,IAAI;AACxC,YAAM,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC,CAAC;AAClD,aAAO,YAAY,QAAQ,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,MAAM,MAAM,CAAC;AAAA,IACxE;AA4EA,aAAa;AAAA,MACX;AAAA,MACA,eAAe,MAAA;;AAAM,+BAAU,UAAV,mBAAiB;AAAA;AAAA,IAAM,CAC7C;;;wBA3SoB,QAAA;AAAA,MAAA;mBACdA,eAAAC,WAAA,EAAA,OAAM,iBAAA,GAAgB,QAAA,QAAA,CAAA,mGAEb,QAAA,KAAK,gEAGVC,cAAA,MAAI,QAAA,OAAO,gBAIXA,cAAA,UAAQ,QAAA,MAAM,0BACJ,QAAA,QAAQ,IAAA,cAAA,+CAGbA,cAAA,OAAK,QAAA,OAAO,oHAEL,QAAA,UAAU,wGAEV,QAAA,UAAU,iDACT,QAAA,UAAU;AAOf,UAAA,cAAA,MAAc,SAAM,GAAA;;sBACA,cAAA,OAAa,CAA7B,MAAM,UAAK;AAC8E,gBAAA,sDAAAC,eAAA,CAAA,EAAA,aAAA,QAAQ,IAAI,EAAA,GAAA,cAAA,CAAA,CAAA,oBAAA;AACnG,cAAA,QAAQ,IAAI,GAAA;uCAAI,OAAK,eAAe,IAAI,CAAA,kBAAI,OAAK,KAAK,IAAI;;AACnD,kBAAA,aAAAA,eAAA,CAAA,YAAY,IAAI,GAAA,WAAA,CAAA,CAAA,wBAAA;AAAA;AACvB,cAAA,QAAQ,IAAI,GAAA;;;;;wGAKIC,eAAA,KAAK,IAAI,kEACT,eAAe,KAAK,IAAI,CAAA;;;;;;UAShD,QAAA,gBAAc;6EACpB,QAAA,cAAc,CAAA,QAAA;AAAA;;;;;;;;;;;;;;"}