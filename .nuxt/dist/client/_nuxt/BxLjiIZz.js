import{_ as D,ad as I,r as v,k as P,B as E,c as h,o as y,a,l as S,n as g,t as r,q as N}from"./C0Gp0dND.js";const j={class:"uploaded-audio"},H={class:"upload-container"},O=["id"],V={class:"upload-content"},$={class:"upload-icon"},W={class:"upload-text"},X={class:"upload-title"},q={class:"upload-subtitle"},G={key:0,class:"uploaded-audio-display"},K={class:"audio-file-info"},J={class:"file-details"},Q={class:"file-name"},Y={class:"file-size"},Z={class:"audio-player"},ee=["title"],ae={class:"time-display"},te={key:1,class:"additional-hint"},le={__name:"UploadAudio",props:{inputId:{type:String,required:!0},label:{type:String,default:"上传音频文件"},uploadIcon:{type:String,default:"fas fa-cloud-upload-alt"},uploadText:{type:String,default:"点击上传音频文件"},uploadHint:{type:String,default:"支持 MP3, WAV, M4A 等格式"},additionalHint:{type:String,default:""},themeColor:{type:String,default:"#10b981"},maxDuration:{type:Number,default:null},maxFileSize:{type:Number,default:10*1024*1024},multiple:{type:Boolean,default:!1}},emits:["update:files"],setup(i,{emit:U}){I(e=>({v39e840aa:i.themeColor}));const f=i,_=U,p=v(null),t=v(null),c=v(null),o=v(!1),u=v(0),d=v(0),x=P(()=>d.value>0?u.value/d.value*100:0),L=()=>{var e;(e=p.value)==null||e.click()},C=e=>{const l=Array.from(e.target.files);if(l.length>0){const n=l[0];B(n)}},B=async e=>{if(!e.type.startsWith("audio/")){alert("请选择音频文件");return}if(e.size>f.maxFileSize){alert(`文件大小不能超过 ${k(f.maxFileSize)}`);return}if(f.maxDuration)try{if(await T(e)>f.maxDuration){alert(`音频时长不能超过 ${f.maxDuration} 秒`);return}}catch(l){console.warn("无法获取音频时长:",l)}c.value=e,t.value&&(t.value.src=URL.createObjectURL(e),t.value.load()),o.value=!1,u.value=0,_("update:files",[e])},T=e=>new Promise((l,n)=>{const s=new Audio,m=URL.createObjectURL(e);s.addEventListener("loadedmetadata",()=>{URL.revokeObjectURL(m),l(s.duration)}),s.addEventListener("error",()=>{URL.revokeObjectURL(m),n(new Error("无法加载音频文件"))}),s.src=m}),R=()=>{t.value&&(o.value?t.value.pause():t.value.play(),o.value=!o.value)},z=()=>{t.value&&(u.value=t.value.currentTime)},F=()=>{t.value&&(d.value=t.value.duration)},M=()=>{o.value=!1,u.value=0,t.value&&(t.value.currentTime=0)},w=e=>{if(!t.value||d.value===0)return;const l=e.currentTarget,s=(e.clientX-l.getBoundingClientRect().left)/l.offsetWidth*d.value;t.value.currentTime=s,u.value=s},A=()=>{t.value&&(t.value.pause(),t.value.currentTime=0,t.value.src=""),c.value=null,o.value=!1,u.value=0,d.value=0,p.value&&(p.value.value=""),_("update:files",[])},k=e=>{if(e===0)return"0 Bytes";const l=1024,n=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/Math.pow(l,s)).toFixed(2))+" "+n[s]},b=e=>{if(isNaN(e))return"0:00";const l=Math.floor(e/60),n=Math.floor(e%60);return`${l}:${n.toString().padStart(2,"0")}`};return E(()=>{c.value&&t.value&&t.value.src&&URL.revokeObjectURL(t.value.src)}),(e,l)=>(y(),h("div",j,[a("div",H,[a("input",{id:i.inputId,ref_key:"fileInput",ref:p,type:"file",accept:"audio/*",onChange:C,class:"file-input"},null,40,O),a("div",{class:"upload-area",onClick:L},[a("div",V,[a("div",$,[a("i",{class:g(i.uploadIcon)},null,2)]),a("div",W,[a("span",X,r(i.uploadText),1),a("small",q,r(i.uploadHint),1)])])])]),c.value?(y(),h("div",G,[a("div",K,[l[1]||(l[1]=a("i",{class:"fas fa-file-audio audio-icon"},null,-1)),a("div",J,[a("span",Q,r(c.value.name),1),a("span",Y,r(k(c.value.size)),1)]),a("button",{type:"button",onClick:A,class:"remove-btn",title:"删除文件"},[...l[0]||(l[0]=[a("i",{class:"fas fa-times"},null,-1)])])]),a("div",Z,[a("button",{type:"button",onClick:R,class:g(["play-pause-btn",{playing:o.value}]),title:o.value?"暂停":"播放"},[a("i",{class:g(o.value?"fas fa-pause":"fas fa-play")},null,2)],10,ee),a("div",{class:"progress-container",onClick:w},[a("div",{class:"progress-bar",style:N({width:x.value+"%"})},null,4)]),a("span",ae,r(b(u.value))+" / "+r(b(d.value)),1)])])):S("",!0),i.additionalHint?(y(),h("div",te,r(i.additionalHint),1)):S("",!0),a("audio",{ref_key:"audioPlayer",ref:t,onTimeupdate:z,onLoadedmetadata:F,onEnded:M},null,544)]))}},oe=D(le,[["__scopeId","data-v-68b38d73"]]);export{oe as U};
