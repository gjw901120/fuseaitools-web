import{p as l}from"./C0Gp0dND.js";function w(){const u=()=>{try{const{token:t}=l();return t!=null&&t.value?t.value:localStorage.getItem("auth_token")}catch{return localStorage.getItem("auth_token")}},s=async t=>{const o=`/api/records/detail?record-id=${encodeURIComponent(t)}`,n={"Content-Type":"application/json",Accept:"application/json"},e=u();e&&(n.Authorization=`Bearer ${e}`);const r=await(await fetch(o,{method:"GET",headers:n,credentials:"include"})).json().catch(()=>null);if(!r||typeof r!="object")return null;const c=r.errorCode??r.error_code,i=r.data;return c==="00000"&&i&&typeof i=="object"?i:null};return{POLL_INTERVAL_MS:1e4,fetchRecordDetailOnce:async t=>!t||typeof t!="string"?null:s(t),pollRecordByStatus:async(t,o={})=>{const n=o.intervalMs??1e4,e=o.getIsCancelled;if(!t||typeof t!="string")throw new Error("recordId is required");for(;;){if(e!=null&&e()||(await new Promise(r=>setTimeout(r,n)),e!=null&&e()))return null;const a=await s(t);if(e!=null&&e())return null;if(a!=null&&Number(a.status)!==1)return a}},pollRecordDetail:async(t,o={})=>{const n=o.intervalMs??1e4;if(!t||typeof t!="string")throw new Error("recordId is required");for(;;){const e=await s(t);if(e&&Array.isArray(e.outputUrls)&&e.outputUrls.length>0)return e;await new Promise(a=>setTimeout(a,n))}}}}export{w as u};
