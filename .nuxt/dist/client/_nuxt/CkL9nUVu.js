import{H as mt,_ as dt,D as ct,E as ft,p as gt,A as vt,k as A,J as bt,r as x,z as yt,c as i,o as r,a as e,s as kt,l as j,n as g,d as k,f as w,v as S,L as D,b as xt,K as Rt,t as b,F as z,j as J}from"./C0Gp0dND.js";import{U as _t}from"./Bunlb4cZ.js";import{u as Ut}from"./BDUmhOtL.js";import{u as wt}from"./CGGC2AfW.js";import{u as It}from"./hrq1PKX5.js";import{u as Tt}from"./xQwj1BY5.js";const At=mt("/tools-logo/FluxKontext.png"),Ft={class:"flux-kontext-tool"},Ct={class:"main-content"},ht={class:"config-panel"},Ot=["disabled"],$t={class:"form-group"},Gt={class:"mode-switch"},Pt={class:"form-group"},Et={class:"form-group"},Mt={class:"checkbox-label",for:"enable-translation"},jt={key:0,class:"form-group"},St={key:0,class:"uploading-hint"},Nt={class:"form-group"},Vt={class:"tab-group"},Lt={class:"tab-row"},Kt={class:"tab-row"},qt={class:"form-group"},Bt={class:"tab-group"},Dt={class:"tab-options"},zt={class:"form-group"},Jt={class:"checkbox-label",for:"prompt-upsampling"},Wt={class:"form-group"},Ht={class:"form-group"},Yt={for:"safety-tolerance",class:"form-label"},Qt={class:"form-group"},Xt={class:"generate-btn-container"},Zt=["disabled"],te={key:0,class:"fas fa-spinner fa-spin"},ee={key:1,class:"fas fa-magic"},ae={class:"price-tag"},oe={class:"result-panel"},se={class:"result-header"},le={class:"result-content"},ne={key:0,class:"image-grid"},ie={class:"image-container"},re=["src","alt"],ue={class:"image-overlay"},pe=["onClick"],me=["onClick"],de={class:"image-info"},ce={class:"image-meta"},fe={class:"image-size"},ge={class:"image-format"},ve={class:"image-prompt"},be={key:1,class:"detail-failure-state"},ye={key:2,class:"detail-loading-state"},ke={key:3,class:"detail-loading-state"},xe={key:4,class:"empty-state"},Re={key:5,class:"image-grid"},_e={class:"image-container"},Ue=["src","alt"],we={class:"image-overlay"},Ie=["onClick"],Te=["onClick"],Ae={class:"image-info"},Fe={class:"image-meta"},Ce={class:"image-size"},he={class:"image-format"},Oe={class:"image-prompt"},$e={__name:"FluxKontextTool",setup(Ge){const W=ct(),O=ft(),{token:F}=gt(),{showError:R}=Ut(),{post:H}=wt(),{fetchRecordDetailOnce:Y,pollRecordByStatus:Q}=Tt(),{fetchPrices:X,getPrice:Z,formatCredits:tt}=It();vt(()=>{X()});const et=A(()=>{const s=a.model==="flux-kontext-max"?"flux_kontext_max":"flux_kontext_pro",t=Z(s),o=tt(t);return o?`(${o})`:""}),a=bt({prompt:"",enableTranslation:!0,inputImage:"",inputImageFile:null,imageUrl:"",aspectRatio:"16:9",outputFormat:"jpeg",promptUpsampling:!1,model:"flux-kontext-pro",safetyTolerance:2,watermark:""}),c=x("generate"),_=x(!1),$=x(!1),I=x([]),G=x(null),at=A(()=>O.query["record-id"]||""),U=A(()=>!!at.value),m=x(null),P=x(null),N={RATIO_21_9:"21:9",RATIO_16_9:"16:9",RATIO_4_3:"4:3",RATIO_1_1:"1:1",RATIO_3_4:"3:4",RATIO_9_16:"9:16"},V=A(()=>{if(!m.value||!Array.isArray(m.value.outputUrls))return[];const s=m.value.outputUrls,t=m.value.originalData||{},o=N[t.aspectRatio]||t.aspectRatio||"16:9",u=(t.outputFormat||"JPEG").toLowerCase()==="png"?"png":"jpeg",p=t.prompt||"";return s.map((l,y)=>({url:typeof l=="string"?l:(l==null?void 0:l.url)??(l==null?void 0:l.imageUrl)??"",aspectRatio:o,format:u,prompt:p})).filter(l=>l.url)});function L(s){if(!s||typeof s!="object")return;const t=s;t.prompt!=null&&(a.prompt=t.prompt),typeof t.enableTranslation=="boolean"&&(a.enableTranslation=t.enableTranslation),t.imageUrl?(a.imageUrl=t.imageUrl,c.value="edit"):c.value="generate",t.aspectRatio&&(a.aspectRatio=N[t.aspectRatio]||t.aspectRatio||a.aspectRatio),t.outputFormat&&(a.outputFormat=(t.outputFormat||"JPEG").toLowerCase()==="png"?"png":"jpeg"),typeof t.promptUpsampling=="boolean"&&(a.promptUpsampling=t.promptUpsampling),t.model&&(a.model=t.model==="flux_kontext_max"?"flux-kontext-max":t.model==="flux_kontext_pro"?"flux-kontext-pro":a.model),t.safetyTolerance!=null&&(a.safetyTolerance=Number(t.safetyTolerance)??2),t.watermark!=null&&(a.watermark=String(t.watermark||""))}function C(){return O.query["record-id"]||""}async function ot(s){if(s&&C()===s&&P.value!==s){P.value=s,m.value=null;try{const t=await Y(s);if(C()!==s)return;m.value=t||null,t!=null&&t.originalData&&L(t.originalData),t!=null&&Number(t.status)===1&&Q(s,{getIsCancelled:()=>C()!==s}).then(o=>{C()===s&&(m.value=o,o!=null&&o.originalData&&L(o.originalData))}).catch(()=>{})}catch(t){console.error("Load record detail failed:",t)}}}yt(()=>O.query["record-id"],s=>{s?ot(s):(P.value=null,m.value=null)},{immediate:!0});const st=()=>{try{return F!=null&&F.value?F.value:localStorage.getItem("auth_token")}catch{return localStorage.getItem("auth_token")}},lt=async s=>{var u,p,l,y,d;if(!s||s.length===0){a.inputImageFile=null,a.inputImage="",a.imageUrl="",(p=(u=G.value)==null?void 0:u.clearFiles)==null||p.call(u);return}const t=s[0]||s,o=Array.isArray(t)?t[0]:t;if(!o){a.imageUrl="";return}a.inputImageFile=o,a.inputImage=URL.createObjectURL(o),$.value=!0;try{const v=new FormData;v.append("file",o);const h={Accept:"application/json"},T=st();T&&(h.Authorization=`Bearer ${T}`);const E=await fetch("/api/common/batch-upload",{method:"POST",headers:h,body:v,credentials:"include"});if(!E.ok){const n=await E.json().catch(()=>({})),pt=typeof(n==null?void 0:n.errorMessage)=="string"&&n.errorMessage.trim()?n.errorMessage.trim():typeof(n==null?void 0:n.message)=="string"&&n.message.trim()?n.message.trim():(n==null?void 0:n.userTip)||(n==null?void 0:n.error)||(n==null?void 0:n.message)||"Upload failed";throw new Error(pt)}const f=await E.json(),M=((l=f==null?void 0:f.data)==null?void 0:l.urls)||(f==null?void 0:f.fileUrls)||(Array.isArray(f==null?void 0:f.data)?f.data:[]);if(Array.isArray(M)&&M[0])a.imageUrl=M[0];else throw new Error("Invalid response: file URL not found")}catch(v){console.error("Input image upload error:",v),R(v.message||"Failed to upload image",5e3),a.imageUrl="",a.inputImageFile=null,a.inputImage="",(d=(y=G.value)==null?void 0:y.clearFiles)==null||d.call(y)}finally{$.value=!1}},K=A(()=>a.prompt.trim()?c.value==="edit"?!!a.imageUrl:!0:!1),nt={"21:9":"RATIO_21_9","16:9":"RATIO_16_9","4:3":"RATIO_4_3","1:1":"RATIO_1_1","3:4":"RATIO_3_4","9:16":"RATIO_9_16"},it={jpeg:"JPEG",png:"PNG"},rt=async()=>{var t,o,u;if(!K.value)return;if(c.value==="edit"&&!a.imageUrl){R("Please upload an image for edit mode");return}const s=a.prompt.trim();if(s.length>5e3){R("Prompt cannot exceed 5000 characters");return}_.value=!0;try{const p={prompt:s,enableTranslation:!!a.enableTranslation,imageUrl:c.value==="edit"?a.imageUrl:"",aspectRatio:nt[a.aspectRatio]||"RATIO_16_9",outputFormat:it[a.outputFormat]||"JPEG",promptUpsampling:!!a.promptUpsampling,model:a.model||"flux-kontext-pro",safetyTolerance:Number(a.safetyTolerance)??2,watermark:a.watermark&&String(a.watermark).trim()||void 0};if(p.watermark&&p.watermark.length>100){R("Watermark identifier cannot exceed 100 characters");return}const l=await H("/api/image/flux-kontext/generate",p),y=(l==null?void 0:l.recordId)??((t=l==null?void 0:l.data)==null?void 0:t.recordId);if(y){W.push(`/home/flux-kontext/generate?record-id=${encodeURIComponent(y)}`);return}let d=l==null?void 0:l.outputUrls;if(!Array.isArray(d)||d.length===0){const T=(l==null?void 0:l.url)??(l==null?void 0:l.imageUrl);T&&(d=[T])}const v=Array.isArray(d)&&d[0]?typeof d[0]=="string"?d[0]:((o=d[0])==null?void 0:o.url)??((u=d[0])==null?void 0:u.imageUrl):null;if(!v||typeof v!="string"){R("No image URL in response");return}const h={url:v,prompt:a.prompt,aspectRatio:a.aspectRatio,format:a.outputFormat,model:a.model,timestamp:new Date};I.value.unshift(h)}catch(p){console.error("生成图像失败:",p),R(p.message||"生成图像失败，请重试")}finally{_.value=!1}},q=s=>{const t=document.createElement("a");t.href=s.url,t.download=`flux-kontext-${Date.now()}.${s.format}`,t.click()},B=async s=>{try{await navigator.clipboard.writeText(s.url),alert("图像URL已复制到剪贴板")}catch(t){console.error("复制失败:",t)}},ut=()=>{I.value=[]};return(s,t)=>(r(),i("div",Ft,[t[55]||(t[55]=e("div",{class:"tool-header"},[e("div",{class:"tool-avatar"},[e("img",{src:At,alt:"Flux Kontext"})]),e("div",{class:"tool-details"},[e("h3",null,"Flux Kontext"),e("p",null,"High-quality image generation and editing model")])],-1)),e("div",Ct,[e("div",ht,[t[44]||(t[44]=e("div",{class:"config-header"},[e("h4",null,"Image Generation Configuration")],-1)),e("form",{class:"config-form",onSubmit:kt(rt,["prevent"])},[e("fieldset",{class:"config-fieldset",disabled:_.value||U.value},[e("div",$t,[t[18]||(t[18]=e("label",{class:"form-label"},"Mode Selection *",-1)),e("div",Gt,[e("button",{type:"button",class:g(["mode-btn",{active:c.value==="generate"}]),onClick:t[0]||(t[0]=o=>c.value="generate")},[...t[16]||(t[16]=[e("i",{class:"fas fa-image"},null,-1),k(" Image Generation ",-1)])],2),e("button",{type:"button",class:g(["mode-btn",{active:c.value==="edit"}]),onClick:t[1]||(t[1]=o=>c.value="edit")},[...t[17]||(t[17]=[e("i",{class:"fas fa-edit"},null,-1),k(" Image Editing ",-1)])],2)])]),e("div",Pt,[t[19]||(t[19]=e("label",{for:"prompt",class:"form-label"},[k(" Prompt "),e("span",{class:"required"},"*")],-1)),w(e("textarea",{id:"prompt","onUpdate:modelValue":t[2]||(t[2]=o=>a.prompt=o),class:"form-input",rows:"4",placeholder:"Describe in detail the image content you want to generate, including scenes, styles, colors, etc... (English only)",required:""},null,512),[[S,a.prompt]]),t[20]||(t[20]=e("div",{class:"form-hint"},' Example: "A serene mountain landscape at sunset with a lake reflecting the orange sky" ',-1))]),e("div",Et,[e("label",Mt,[w(e("input",{id:"enable-translation",type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=o=>a.enableTranslation=o)},null,512),[[D,a.enableTranslation]]),t[21]||(t[21]=e("span",{class:"checkmark"},null,-1)),t[22]||(t[22]=k(" Enable Auto Translation ",-1))]),t[23]||(t[23]=e("div",{class:"form-hint"}," Automatically translate non-English prompts to English ",-1))]),c.value==="edit"?(r(),i("div",jt,[xt(_t,{ref_key:"inputImageUploadRef",ref:G,"input-id":"flux-kontext-input-image",label:"Upload Image *","upload-icon":"fas fa-cloud-upload-alt","upload-text":"Click to upload image","upload-hint":"Supports .jfif, .jpeg, .jpg, .png, .webp",multiple:!1,"max-file-size":10*1024*1024,"additional-hint":"Must be a valid image file for edit mode","theme-color":"#667eea","onUpdate:files":lt},null,512),$.value?(r(),i("div",St,[...t[24]||(t[24]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),k(" Uploading image... ",-1)])])):j("",!0)])):j("",!0),e("div",Nt,[t[31]||(t[31]=e("label",{class:"form-label"},"Aspect Ratio",-1)),e("div",Vt,[e("div",Lt,[e("button",{type:"button",class:g(["tab-option",{active:a.aspectRatio==="21:9"}]),onClick:t[4]||(t[4]=o=>a.aspectRatio="21:9")},[...t[25]||(t[25]=[e("span",null,"21:9",-1),e("span",{class:"tab-label"},"Ultra Wide",-1)])],2),e("button",{type:"button",class:g(["tab-option",{active:a.aspectRatio==="16:9"}]),onClick:t[5]||(t[5]=o=>a.aspectRatio="16:9")},[...t[26]||(t[26]=[e("span",null,"16:9",-1),e("span",{class:"tab-label"},"Wide",-1)])],2),e("button",{type:"button",class:g(["tab-option",{active:a.aspectRatio==="4:3"}]),onClick:t[6]||(t[6]=o=>a.aspectRatio="4:3")},[...t[27]||(t[27]=[e("span",null,"4:3",-1),e("span",{class:"tab-label"},"Standard",-1)])],2)]),e("div",Kt,[e("button",{type:"button",class:g(["tab-option",{active:a.aspectRatio==="1:1"}]),onClick:t[7]||(t[7]=o=>a.aspectRatio="1:1")},[...t[28]||(t[28]=[e("span",null,"1:1",-1),e("span",{class:"tab-label"},"Square",-1)])],2),e("button",{type:"button",class:g(["tab-option",{active:a.aspectRatio==="3:4"}]),onClick:t[8]||(t[8]=o=>a.aspectRatio="3:4")},[...t[29]||(t[29]=[e("span",null,"3:4",-1),e("span",{class:"tab-label"},"Portrait",-1)])],2),e("button",{type:"button",class:g(["tab-option",{active:a.aspectRatio==="9:16"}]),onClick:t[9]||(t[9]=o=>a.aspectRatio="9:16")},[...t[30]||(t[30]=[e("span",null,"9:16",-1),e("span",{class:"tab-label"},"Mobile",-1)])],2)])])]),e("div",qt,[t[34]||(t[34]=e("label",{class:"form-label"},"Output Format",-1)),e("div",Bt,[e("div",Dt,[e("button",{type:"button",class:g(["tab-option",{active:a.outputFormat==="jpeg"}]),onClick:t[10]||(t[10]=o=>a.outputFormat="jpeg")},[...t[32]||(t[32]=[e("span",null,"JPEG",-1)])],2),e("button",{type:"button",class:g(["tab-option",{active:a.outputFormat==="png"}]),onClick:t[11]||(t[11]=o=>a.outputFormat="png")},[...t[33]||(t[33]=[e("span",null,"PNG",-1)])],2)])])]),e("div",zt,[e("label",Jt,[w(e("input",{id:"prompt-upsampling",type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=o=>a.promptUpsampling=o)},null,512),[[D,a.promptUpsampling]]),t[35]||(t[35]=e("span",{class:"checkmark"},null,-1)),t[36]||(t[36]=k(" Prompt Enhancement ",-1))]),t[37]||(t[37]=e("div",{class:"form-hint"}," Enhance the prompt, may increase processing time ",-1))]),e("div",Wt,[t[39]||(t[39]=e("label",{for:"model",class:"form-label"},"Model Version",-1)),w(e("select",{id:"model","onUpdate:modelValue":t[13]||(t[13]=o=>a.model=o),class:"form-input"},[...t[38]||(t[38]=[e("option",{value:"flux-kontext-pro"},"Flux Kontext Pro - Performance Balanced",-1),e("option",{value:"flux-kontext-max"},"Flux Kontext Max - Advanced Features",-1)])],512),[[Rt,a.model]]),t[40]||(t[40]=e("div",{class:"form-hint"}," Max version has higher quality and detail, suitable for complex tasks ",-1))]),e("div",Ht,[e("label",Yt," Safety Tolerance ("+b(a.safetyTolerance)+") ",1),w(e("input",{id:"safety-tolerance","onUpdate:modelValue":t[14]||(t[14]=o=>a.safetyTolerance=o),type:"range",min:"0",max:"6",class:"form-slider"},null,512),[[S,a.safetyTolerance]]),t[41]||(t[41]=e("div",{class:"slider-labels"},[e("span",null,"Strictest (0)"),e("span",null,"More Relaxed (6)")],-1))]),e("div",Qt,[t[42]||(t[42]=e("label",{for:"watermark",class:"form-label"},"Watermark Identifier",-1)),w(e("input",{id:"watermark","onUpdate:modelValue":t[15]||(t[15]=o=>a.watermark=o),type:"text",class:"form-input",placeholder:"your-watermark-id"},null,512),[[S,a.watermark]]),t[43]||(t[43]=e("div",{class:"form-hint"}," Optional, if provided will add a watermark to the output image ",-1))]),e("div",Xt,[e("button",{type:"submit",class:"generate-btn",disabled:!K.value||_.value},[_.value?(r(),i("i",te)):(r(),i("i",ee)),k(" "+b(_.value?"Generating...":"Generate Image")+" ",1),e("span",ae,b(et.value),1)],8,Zt)])],8,Ot)],32)]),e("div",oe,[e("div",se,[t[46]||(t[46]=e("h4",null,"Generation Result",-1)),!U.value&&I.value.length>0?(r(),i("button",{key:0,onClick:ut,class:"clear-btn"},[...t[45]||(t[45]=[e("i",{class:"fas fa-trash"},null,-1),k(" Clear Results ",-1)])])):j("",!0)]),e("div",le,[U.value&&m.value&&m.value.status===2&&V.value.length>0?(r(),i("div",ne,[(r(!0),i(z,null,J(V.value,(o,u)=>(r(),i("div",{key:u,class:"image-item"},[e("div",ie,[e("img",{src:o.url,alt:`Generated image ${u+1}`},null,8,re),e("div",ue,[e("button",{onClick:p=>q(o),class:"action-btn"},[...t[47]||(t[47]=[e("i",{class:"fas fa-download"},null,-1)])],8,pe),e("button",{onClick:p=>B(o),class:"action-btn"},[...t[48]||(t[48]=[e("i",{class:"fas fa-copy"},null,-1)])],8,me)])]),e("div",de,[e("div",ce,[e("span",fe,b(o.aspectRatio),1),e("span",ge,b(o.format.toUpperCase()),1)]),e("div",ve,b(o.prompt),1)])]))),128))])):U.value&&m.value&&m.value.status===3?(r(),i("div",be,[...t[49]||(t[49]=[e("div",{class:"failure-icon"},[e("i",{class:"fas fa-exclamation-circle"})],-1),e("p",{class:"failure-message"},"Generation failed. You can debug the parameters and try generating again. Generation failure will not consume credits.",-1)])])):U.value&&(!m.value||m.value.status===1)?(r(),i("div",ye,[...t[50]||(t[50]=[e("i",{class:"fas fa-spinner fa-spin detail-spinner"},null,-1),e("p",null,"Generating...",-1)])])):U.value?(r(),i("div",ke,[...t[51]||(t[51]=[e("p",null,"No output images",-1)])])):I.value.length===0?(r(),i("div",xe,[...t[52]||(t[52]=[e("i",{class:"fas fa-image"},null,-1),e("p",null,"No image generated yet",-1),e("span",null,'Configure parameters and click "Generate Image" to start creating',-1)])])):(r(),i("div",Re,[(r(!0),i(z,null,J(I.value,(o,u)=>(r(),i("div",{key:u,class:"image-item"},[e("div",_e,[e("img",{src:o.url,alt:`Generated image ${u+1}`},null,8,Ue),e("div",we,[e("button",{onClick:p=>q(o),class:"action-btn"},[...t[53]||(t[53]=[e("i",{class:"fas fa-download"},null,-1)])],8,Ie),e("button",{onClick:p=>B(o),class:"action-btn"},[...t[54]||(t[54]=[e("i",{class:"fas fa-copy"},null,-1)])],8,Te)])]),e("div",Ae,[e("div",Fe,[e("span",Ce,b(o.aspectRatio),1),e("span",he,b(o.format.toUpperCase()),1)]),e("div",Oe,b(o.prompt),1)])]))),128))]))])])])]))}},Ve=dt($e,[["__scopeId","data-v-276f8842"]]);export{Ve as F};
