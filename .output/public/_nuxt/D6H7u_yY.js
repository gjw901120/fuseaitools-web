import{H as ie,_ as le,D as ne,E as re,I as de,p as ue,A as ce,J as ve,r as f,k as D,z as pe,c as u,o as c,a as t,e as z,s as fe,f as F,v as E,l as b,n as me,d as x,t as g,F as ge,j as he}from"./C0Gp0dND.js";import{u as ye}from"./BDUmhOtL.js";import{u as we}from"./CGGC2AfW.js";import{u as _e}from"./hrq1PKX5.js";import{u as be}from"./xQwj1BY5.js";const ke=ie("/tools-logo/Luma.png"),Ve={class:"luma-tool"},Me={class:"main-content"},Ue={class:"config-panel"},Re=["disabled"],Le={class:"form-group"},Se={class:"form-group"},Ae={class:"luma-video-upload"},De={key:0,class:"luma-video-uploading"},Ie={key:1,class:"luma-video-display"},xe={class:"luma-video-preview-wrap"},Be=["src"],Ce={key:0,class:"luma-video-meta"},Te={class:"luma-video-name"},Oe={class:"luma-video-size"},ze={class:"form-group"},Fe={class:"form-actions"},Ee=["disabled"],Pe={key:0,class:"fas fa-spinner fa-spin"},je={key:1,class:"fas fa-magic"},qe={key:2,class:"price-tag"},Ne={class:"result-panel"},We={class:"video-header"},$e={key:0,class:"video-actions"},Ge={class:"video-container"},He={key:0,class:"video-showcase"},Je={class:"video-player"},Ke=["src","poster"],Ye={class:"video-details"},Qe={class:"video-meta"},Xe={class:"video-duration"},Ze={class:"video-size"},et={key:0,class:"video-watermark"},tt={class:"video-actions"},at=["onClick"],st=["onClick"],ot={key:1,class:"empty-state"},it={__name:"LumaTool",setup(lt){const P=ne(),M=re(),B=de("addToUsageHistory"),{token:U}=ue(),{fetchPrices:j,getPrice:q,formatCredits:N}=_e();ce(()=>{j()});const{showError:R}=ye(),{post:W}=we(),{fetchRecordDetailOnce:$,pollRecordByStatus:G}=be(),H=()=>{try{return U!=null&&U.value?U.value:localStorage.getItem("auth_token")}catch{return localStorage.getItem("auth_token")}},J=async a=>{var V,m,A;if(!a)return"";const e=new FormData;e.append("file",a);const o={Accept:"application/json"},s=H();s&&(o.Authorization=`Bearer ${s}`);const l=await fetch("/api/common/batch-upload",{method:"POST",headers:o,body:e,credentials:"include"});if(!l.ok){const i=await l.json().catch(()=>({})),oe=typeof(i==null?void 0:i.errorMessage)=="string"&&((V=i.errorMessage)!=null&&V.trim())?i.errorMessage.trim():typeof(i==null?void 0:i.message)=="string"&&((m=i.message)!=null&&m.trim())?i.message.trim():(i==null?void 0:i.userTip)||(i==null?void 0:i.error)||(i==null?void 0:i.message)||"Upload failed";throw new Error(oe)}const n=await l.json(),r=((A=n==null?void 0:n.data)==null?void 0:A.urls)||(n==null?void 0:n.fileUrls)||(Array.isArray(n==null?void 0:n.data)?n.data:[]);if(!Array.isArray(r)||!r[0])throw new Error("Invalid response: file URL not found");return r[0]},d=ve({prompt:"",watermark:""}),v=f(""),h=f(null),y=f(null),L=f(!1),I=f(null),w=f(!1),K=a=>{if(a==null||a===0)return"0 B";const e=1024,o=["B","KB","MB","GB"],s=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,s)).toFixed(2))+" "+o[s]},_=f([]),Y=D(()=>M.query["record-id"]||""),Q=D(()=>!!Y.value),p=f(null),k=f(null);f(null),D(()=>{var a,e,o,s,l;return Q.value&&((a=p.value)==null?void 0:a.status)===2&&((o=(e=p.value)==null?void 0:e.outputUrls)!=null&&o.length)?[{id:"detail",url:typeof p.value.outputUrls[0]=="string"?p.value.outputUrls[0]:(s=p.value.outputUrls[0])==null?void 0:s.url,prompt:((l=p.value.originalData)==null?void 0:l.prompt)||"",createdAt:new Date().toISOString()}]:_.value});function C(a){!a||typeof a!="object"||Object.keys(d).forEach(e=>{a[e]!==void 0&&(d[e]=a[e])})}function S(){return M.query["record-id"]||""}async function X(a){if(a&&S()===a&&k.value!==a){k.value=a,p.value=null;try{const e=await $(a);if(S()!==a)return;p.value=e||null,e!=null&&e.originalData&&C(e.originalData),e!=null&&Number(e.status)===1&&G(a,{getIsCancelled:()=>S()!==a}).then(o=>{S()===a&&(p.value=o,o!=null&&o.originalData&&C(o.originalData))}).catch(()=>{})}catch(e){console.error("Load record detail failed:",e)}finally{k.value===a&&(k.value=null)}}}pe(()=>M.query["record-id"],a=>{a?X(a):(k.value=null,p.value=null)},{immediate:!0});const T=D(()=>{const a=q("Luma"),e=N(a);return e?`(${e})`:""}),Z=async a=>{var o;const e=(o=a.target.files)==null?void 0:o[0];if(e){if(!e.type.startsWith("video/")){R("Please select a valid video format (MP4, MOV, AVI)"),a.target.value="";return}if(e.size>500*1024*1024){R("Video size cannot exceed 500MB"),a.target.value="";return}h.value=e,y.value=null,v.value=URL.createObjectURL(e),L.value=!0;try{y.value=await J(e)}catch(s){console.error("Luma video upload failed:",s),R((s==null?void 0:s.message)||"Video upload failed"),v.value&&v.value.startsWith("blob:")&&URL.revokeObjectURL(v.value),v.value="",h.value=null}finally{L.value=!1}a.target.value=""}},O=()=>{v.value&&v.value.startsWith("blob:")&&URL.revokeObjectURL(v.value),v.value="",h.value=null,y.value=null,I.value&&(I.value.value="")},ee=async()=>{var e,o,s;const a=(e=d.prompt)==null?void 0:e.trim();if(!(!a||!y.value)){B&&B("Luma"),w.value=!0;try{const l=y.value,n={prompt:a,videoUrl:l,watermark:((o=d.watermark)==null?void 0:o.trim())||void 0},r=await W("/api/video/luma/generate",n),V=(r==null?void 0:r.recordId)??((s=r==null?void 0:r.data)==null?void 0:s.recordId);if(V){P.push(M.path+"?record-id="+encodeURIComponent(V));return}let m=(r==null?void 0:r.data)??r;const A={id:m.taskId||Date.now(),url:m.videoUrl||m.url,thumbnail:m.thumbnail,duration:m.duration||"",size:m.size||"",watermark:d.watermark||null,prompt:d.prompt,originalUrl:l,createdAt:new Date().toISOString()};_.value.unshift(A),d.prompt="",d.watermark="",O()}catch(l){console.error("Failed to modify video:",l),R((l==null?void 0:l.message)||"Request failed")}finally{w.value=!1}}},te=a=>{console.log("Download video:",a)},ae=a=>{console.log("Share video:",a)},se=()=>{_.value=[]};return(a,e)=>{var o;return c(),u("div",Ve,[e[16]||(e[16]=t("div",{class:"tool-header"},[t("div",{class:"tool-avatar"},[t("img",{src:ke,alt:"Luma"})]),t("div",{class:"tool-details"},[t("h3",null,"Luma"),t("p",null,"Build and scale creative products with the world's most popular and intuitive Video and Image generation models with Luma.")])],-1)),t("div",Me,[t("div",Ue,[e[10]||(e[10]=t("div",{class:"config-header"},[t("h4",null,"Video Modification Configuration")],-1)),t("form",{class:"config-form",onSubmit:fe(ee,["prevent"])},[t("fieldset",{class:"config-fieldset",disabled:w.value},[t("div",Le,[e[2]||(e[2]=t("label",{for:"prompt"},"Modification Description *",-1)),F(t("textarea",{id:"prompt","onUpdate:modelValue":e[0]||(e[0]=s=>d.prompt=s),placeholder:"Text prompt describing the desired video modification. Should be detailed and specific in describing the desired changes, describing the visual elements you want to add or modify. Important: English only.",rows:"4",required:""},null,512),[[E,d.prompt]])]),t("div",Se,[e[6]||(e[6]=t("label",{class:"form-label"},"Input Video *",-1)),t("div",Ae,[t("div",{class:me(["luma-video-trigger",{"has-video":v.value}])},[t("input",{ref_key:"videoInputRef",ref:I,type:"file",accept:"video/*",onChange:Z,class:"luma-video-file-input"},null,544),e[3]||(e[3]=t("div",{class:"luma-video-trigger-inner"},[t("i",{class:"fas fa-cloud-upload-alt"}),t("span",null,"Click to upload video"),t("small",null,"Supports MP4, MOV, AVI, max 500MB")],-1))],2),L.value?(c(),u("div",De,[...e[4]||(e[4]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),x(" Uploading video... ",-1)])])):b("",!0),v.value&&!L.value?(c(),u("div",Ie,[t("div",xe,[t("video",{src:v.value,class:"luma-video-preview",controls:""},null,8,Be),t("button",{type:"button",class:"luma-video-remove",title:"Remove",onClick:O},[...e[5]||(e[5]=[t("i",{class:"fas fa-times"},null,-1)])])]),h.value?(c(),u("div",Ce,[t("span",Te,g(h.value.name),1),t("span",Oe,g(K(h.value.size)),1)])):b("",!0)])):b("",!0)]),e[7]||(e[7]=t("div",{class:"form-hint"}," Input video for modification. Supports MP4, MOV, AVI formats, maximum 500MB, maximum 10 seconds. ",-1))]),t("div",ze,[e[8]||(e[8]=t("label",{for:"watermark"},"Watermark Identifier",-1)),F(t("input",{id:"watermark","onUpdate:modelValue":e[1]||(e[1]=s=>d.watermark=s),type:"text",placeholder:"your-watermark-id"},null,512),[[E,d.watermark]]),e[9]||(e[9]=t("div",{class:"form-help"}," Optional parameter. If provided, a watermark will be added to the output video, which can be used for branding or identification purposes. ",-1))]),t("div",Fe,[t("button",{type:"submit",class:"btn-primary",disabled:!((o=d.prompt)!=null&&o.trim())||!y.value||w.value},[w.value?(c(),u("i",Pe)):(c(),u("i",je)),x(" "+g(w.value?"Modifying...":"Modify Video")+" ",1),T.value?(c(),u("span",qe,g(T.value),1)):b("",!0)],8,Ee)])],8,Re)],32)]),t("div",Ne,[t("div",We,[e[12]||(e[12]=t("h4",null,"Video Preview",-1)),_.value.length>0?(c(),u("div",$e,[t("button",{onClick:se,class:"btn-secondary"},[...e[11]||(e[11]=[t("i",{class:"fas fa-trash"},null,-1),x(" Clear All ",-1)])])])):b("",!0)]),t("div",Ge,[_.value.length>0?(c(),u("div",He,[(c(!0),u(ge,null,he(_.value,(s,l)=>(c(),u("div",{key:l,class:"video-showcase-item"},[t("div",Je,[t("video",{controls:"",src:s.url,poster:s.thumbnail}," Your browser does not support video playback ",8,Ke)]),t("div",Ye,[t("div",Qe,[t("span",Xe,g(s.duration),1),t("span",Ze,g(s.size),1),s.watermark?(c(),u("span",et,g(s.watermark),1)):b("",!0)]),t("div",tt,[t("button",{onClick:n=>te(s),class:"btn-icon",title:"Download"},[...e[13]||(e[13]=[t("i",{class:"fas fa-download"},null,-1)])],8,at),t("button",{onClick:n=>ae(s),class:"btn-icon",title:"Share"},[...e[14]||(e[14]=[t("i",{class:"fas fa-share"},null,-1)])],8,st)])])]))),128))])):(c(),u("div",ot,[...e[15]||(e[15]=[z('<div class="empty-icon" data-v-62cf1994><i class="fas fa-magic" data-v-62cf1994></i></div><h3 data-v-62cf1994>Waiting to Modify Video</h3><p data-v-62cf1994>Enter video URL and modification description, click &quot;Modify Video&quot; button to start processing</p><div class="empty-features" data-v-62cf1994><div class="feature-item" data-v-62cf1994><i class="fas fa-cube" data-v-62cf1994></i><span data-v-62cf1994>3D Video Generation</span></div><div class="feature-item" data-v-62cf1994><i class="fas fa-edit" data-v-62cf1994></i><span data-v-62cf1994>Video Modification</span></div><div class="feature-item" data-v-62cf1994><i class="fas fa-eye" data-v-62cf1994></i><span data-v-62cf1994>Visual Effects</span></div></div>',4)])]))])])]),e[17]||(e[17]=z('<div class="usage-tips" data-v-62cf1994><div class="tip-item" data-v-62cf1994><span class="tip-icon" data-v-62cf1994>ğŸŒ</span><span data-v-62cf1994><strong data-v-62cf1994>English Description:</strong> All prompts must be in English, ensure description is accurate and clear</span></div><div class="tip-item" data-v-62cf1994><span class="tip-icon" data-v-62cf1994>ğŸ“</span><span data-v-62cf1994><strong data-v-62cf1994>Detailed Description:</strong> Specifically describe the visual elements to add or modify</span></div><div class="tip-item" data-v-62cf1994><span class="tip-icon" data-v-62cf1994>ğŸ¥</span><span data-v-62cf1994><strong data-v-62cf1994>Video Requirements:</strong> Input video maximum 500MB, maximum 10 seconds</span></div><div class="tip-item" data-v-62cf1994><span class="tip-icon" data-v-62cf1994>ğŸ“</span><span data-v-62cf1994><strong data-v-62cf1994>Format Support:</strong> Supports MP4, MOV, AVI formats</span></div><div class="tip-item" data-v-62cf1994><span class="tip-icon" data-v-62cf1994>ğŸ¬</span><span data-v-62cf1994><strong data-v-62cf1994>3D Effects:</strong> Focus on 3D scenes and three-dimensional visual effects</span></div></div>',1))])}}},vt=le(it,[["__scopeId","data-v-62cf1994"]]);export{vt as L};
