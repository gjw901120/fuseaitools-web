import{H as ie,_ as oe,D as ne,E as le,p as re,A as ce,k as R,J as de,r as v,z as pe,c as d,o as p,e as P,a,s as ue,n as x,f as N,v as me,b as fe,l as $,d as C,L as ve,t as h,F as V,j as B}from"./C0Gp0dND.js";import{U as ge}from"./Bunlb4cZ.js";import{u as ye}from"./BDUmhOtL.js";import{u as he}from"./hrq1PKX5.js";import{u as be}from"./xQwj1BY5.js";import{u as _e}from"./CGGC2AfW.js";const ke=ie("/tools-logo/ChatGpt.png"),Ue={class:"gpt4o-image-tool"},we={class:"main-content"},Ie={class:"config-panel"},Ae=["disabled"],Re={class:"form-group"},Ce={class:"tab-group"},ze={class:"form-group"},Ge={class:"form-group"},Te={key:0,class:"uploading-hint"},Ee={class:"form-group"},Pe={class:"checkbox-label"},xe=["disabled"],$e={key:0,class:"fas fa-spinner fa-spin"},Se={key:1,class:"fas fa-magic"},Le={class:"image-display-panel"},Me={class:"image-header"},je={key:0,class:"image-actions"},qe={class:"image-container"},Fe={key:0,class:"image-showcase"},Ne={class:"image-wrapper"},Ve=["src","alt"],Be={class:"image-overlay"},Oe=["onClick"],De=["onClick"],He={class:"image-info"},Je={class:"image-size"},We={class:"image-time"},Ye={key:1,class:"detail-failure-state"},Ke={key:2,class:"detail-loading-state"},Qe={key:3,class:"detail-loading-state"},Xe={key:4,class:"image-showcase"},Ze={class:"image-wrapper"},ea=["src","alt"],aa={class:"image-overlay"},sa=["onClick"],ta=["onClick"],ia={class:"image-info"},oa={class:"image-size"},na={class:"image-time"},la={key:5,class:"empty-state"},ra={__name:"GPT4oImageTool",setup(ca){const O=ne(),z=le(),{token:w}=re(),{showError:I}=ye(),{fetchPrices:D,getPrice:H,formatCredits:J}=he();ce(()=>{D()});const W=R(()=>{const s=H("GPT_4o_image"),e=J(s);return e?`(${e})`:""}),o=de({size:"1:1",prompt:"",filesUrl:[],isEnhance:!1}),g=v(!1),G=v(!1),b=v([]),T=v([]),S=v(null),Y=()=>{try{return w!=null&&w.value?w.value:localStorage.getItem("auth_token")}catch{return localStorage.getItem("auth_token")}},K=async s=>{var e,t,l,u;if(!Array.isArray(s)||s.length===0){T.value=[],o.filesUrl=[];return}G.value=!0;try{const i=new FormData;s.forEach(n=>i.append("file",n));const k={Accept:"application/json"},y=Y();y&&(k.Authorization=`Bearer ${y}`);const U=await fetch("/api/common/batch-upload",{method:"POST",headers:k,body:i,credentials:"include"});if(!U.ok){const n=await U.json().catch(()=>({})),E=typeof(n==null?void 0:n.errorMessage)=="string"&&n.errorMessage.trim()?n.errorMessage.trim():typeof(n==null?void 0:n.message)=="string"&&n.message.trim()?n.message.trim():(n==null?void 0:n.userTip)||(n==null?void 0:n.error)||(n==null?void 0:n.message)||"Upload failed";throw new Error(E)}const r=await U.json();let f=[];if(r.errorCode==="00000"&&((e=r.data)!=null&&e.urls)&&Array.isArray(r.data.urls)||(t=r.data)!=null&&t.urls&&Array.isArray(r.data.urls)?f=r.data.urls:r.fileUrls&&Array.isArray(r.fileUrls)&&(f=r.fileUrls),f.length===0)throw new Error("Invalid response: file URLs not found");o.filesUrl=f,T.value=s.map((n,E)=>({name:n.name,file:n,url:f[E]||URL.createObjectURL(n)}))}catch(i){console.error("Reference images upload error:",i),I(i.message||"Failed to upload reference images",5e3),T.value=[],o.filesUrl=[],(u=(l=S.value)==null?void 0:l.clearFiles)==null||u.call(l)}finally{G.value=!1}},{post:Q}=_e(),{fetchRecordDetailOnce:X,pollRecordByStatus:Z}=be(),ee=R(()=>z.query["record-id"]||""),m=R(()=>!!ee.value),c=v(null),L=v(!1),_=v(null),M=R(()=>{var t;if(!c.value||!Array.isArray(c.value.outputUrls))return[];const s=c.value.outputUrls,e=((t=c.value.originalData)==null?void 0:t.size)||"1:1";return s.map((l,u)=>{var i;return{id:`detail-${u}`,url:typeof l=="string"?l:(l==null?void 0:l.url)??(l==null?void 0:l.imageUrl)??"",size:e,timestamp:new Date().toLocaleTimeString(),prompt:(i=c.value.originalData)==null?void 0:i.prompt}}).filter(l=>l.url)});function j(s){!s||typeof s!="object"||(s.size&&(o.size=s.size),typeof s.prompt=="string"&&(o.prompt=s.prompt),Array.isArray(s.imageUrls)&&(o.filesUrl=[...s.imageUrls]),typeof s.isEnhance=="boolean"&&(o.isEnhance=s.isEnhance))}function A(){return z.query["record-id"]||""}async function ae(s){if(s&&A()===s&&_.value!==s){_.value=s,L.value=!0,c.value=null;try{const e=await X(s);if(A()!==s)return;c.value=e||null,e!=null&&e.originalData&&j(e.originalData),e!=null&&Number(e.status)===1&&Z(s,{getIsCancelled:()=>A()!==s}).then(t=>{A()===s&&(c.value=t,t!=null&&t.originalData&&j(t.originalData))}).catch(()=>{})}catch(e){console.error("Load record detail failed:",e)}finally{_.value===s&&(_.value=null),L.value=!1}}}pe(()=>z.query["record-id"],s=>{s?ae(s):(_.value=null,c.value=null)},{immediate:!0});const se=async()=>{var s,e,t,l;if(!((s=o.prompt)!=null&&s.trim())&&(!o.filesUrl||o.filesUrl.length===0)){I("At least one of Reference Images and prompt is required");return}g.value=!0;try{const u={size:o.size,imageUrls:Array.isArray(o.filesUrl)?o.filesUrl:[],prompt:((e=o.prompt)==null?void 0:e.trim())||"",isEnhance:!!o.isEnhance},i=await Q("/api/image/gpt4o-image/generate",u),k=(i==null?void 0:i.recordId)??((t=i==null?void 0:i.data)==null?void 0:t.recordId);if(k){O.push(`/home/gpt-4o-image/generate?record-id=${encodeURIComponent(k)}`);return}let y=(i==null?void 0:i.outputUrls)??(i==null?void 0:i.urls)??((l=i==null?void 0:i.data)==null?void 0:l.outputUrls)??(i==null?void 0:i.images)??(Array.isArray(i)?i:[]);if(!Array.isArray(y)||y.length===0){I("No image URLs in response");return}const U=y.map((r,f)=>({id:Date.now()+f,url:typeof r=="string"?r:(r==null?void 0:r.url)??(r==null?void 0:r.imageUrl)??"",size:o.size,timestamp:new Date().toLocaleTimeString(),prompt:o.prompt})).filter(r=>r.url);b.value.unshift(...U)}catch(u){console.error("Image generation failed:",u),I(u.message||"Image generation failed, please try again")}finally{g.value=!1}},q=s=>{const e=document.createElement("a");e.href=s.url,e.download=`gpt4o-image-${Date.now()}.png`,e.click()},F=async s=>{try{await navigator.clipboard.writeText(s.url),alert("Image URL copied to clipboard")}catch(e){console.error("Copy failed:",e)}},te=()=>{b.value=[]};return(s,e)=>(p(),d("div",Ue,[e[25]||(e[25]=P('<div class="tool-header" data-v-365c3161><div class="header-left" data-v-365c3161><div class="tool-icon" data-v-365c3161><img src="'+ke+'" alt="GPT-4o Image" data-v-365c3161></div><div class="tool-info" data-v-365c3161><h3 data-v-365c3161>GPT 4o Image</h3><p data-v-365c3161>OpenAI GPT-4o image generation tool</p></div></div></div>',1)),a("div",we,[a("div",Ie,[e[14]||(e[14]=a("div",{class:"config-header"},[a("h4",null,"Image Generation Configuration")],-1)),a("form",{class:"config-form",onSubmit:ue(se,["prevent"])},[a("fieldset",{class:"config-fieldset",disabled:g.value||m.value},[a("div",Re,[e[8]||(e[8]=a("label",null,"Image Aspect Ratio *",-1)),a("div",Ce,[a("div",{class:x(["tab-option",{active:o.size==="1:1"}]),onClick:e[0]||(e[0]=t=>o.size="1:1")},[...e[5]||(e[5]=[a("span",null,"1:1",-1)])],2),a("div",{class:x(["tab-option",{active:o.size==="3:2"}]),onClick:e[1]||(e[1]=t=>o.size="3:2")},[...e[6]||(e[6]=[a("i",{class:"fas fa-rectangle-wide"},null,-1),a("span",null,"3:2",-1)])],2),a("div",{class:x(["tab-option",{active:o.size==="2:3"}]),onClick:e[2]||(e[2]=t=>o.size="2:3")},[...e[7]||(e[7]=[a("i",{class:"fas fa-rectangle-portrait"},null,-1),a("span",null,"2:3",-1)])],2)])]),a("div",ze,[e[9]||(e[9]=a("label",null,"Prompt *",-1)),N(a("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.prompt=t),placeholder:"Describe the image content you want to generate...",rows:"4",class:"form-input",required:""},null,512),[[me,o.prompt]]),e[10]||(e[10]=a("div",{class:"input-hint"},"At least one of Reference Images and prompt is required",-1))]),a("div",Ge,[fe(ge,{ref_key:"referenceImagesUploadRef",ref:S,"input-id":"gpt4o-reference-images",label:"Reference Images (Optional)","upload-icon":"fas fa-cloud-upload-alt","upload-text":"Click to upload reference images","upload-hint":"Supports .jfif, .jpeg, .jpg, .png, .webp (max 5 images)","max-files":5,"max-file-size":10*1024*1024,"additional-hint":"Upload reference images to guide generation direction","theme-color":"#667eea","onUpdate:files":K},null,512),G.value?(p(),d("div",Te,[...e[11]||(e[11]=[a("i",{class:"fas fa-spinner fa-spin"},null,-1),C(" Uploading reference images... ",-1)])])):$("",!0)]),a("div",Ee,[a("label",Pe,[N(a("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>o.isEnhance=t)},null,512),[[ve,o.isEnhance]]),e[12]||(e[12]=a("span",{class:"checkmark"},null,-1)),e[13]||(e[13]=C(" Prompt Enhancement (Suitable for 3D images and specific scenarios) ",-1))])]),a("button",{type:"submit",disabled:g.value||!o.prompt.trim(),class:"generate-btn"},[g.value?(p(),d("i",$e)):(p(),d("i",Se)),C(" "+h(g.value?"Generating...":"Generate Image")+h(W.value),1)],8,xe)],8,Ae)],32)]),a("div",Le,[a("div",Me,[e[16]||(e[16]=a("h4",null,"Image Preview",-1)),!m.value&&b.value.length>0?(p(),d("div",je,[a("button",{onClick:te,class:"btn-secondary"},[...e[15]||(e[15]=[a("i",{class:"fas fa-trash"},null,-1),C(" Clear ",-1)])])])):$("",!0)]),a("div",qe,[m.value&&c.value&&c.value.status===2&&M.value.length>0?(p(),d("div",Fe,[(p(!0),d(V,null,B(M.value,(t,l)=>(p(),d("div",{key:l,class:"image-item"},[a("div",Ne,[a("img",{src:t.url,alt:`Generated image ${l+1}`},null,8,Ve),a("div",Be,[a("button",{onClick:u=>q(t),class:"action-btn"},[...e[17]||(e[17]=[a("i",{class:"fas fa-download"},null,-1)])],8,Oe),a("button",{onClick:u=>F(t),class:"action-btn"},[...e[18]||(e[18]=[a("i",{class:"fas fa-copy"},null,-1)])],8,De)])]),a("div",He,[a("span",Je,h(t.size),1),a("span",We,h(t.timestamp),1)])]))),128))])):m.value&&c.value&&c.value.status===3?(p(),d("div",Ye,[...e[19]||(e[19]=[a("div",{class:"failure-icon"},[a("i",{class:"fas fa-exclamation-circle"})],-1),a("p",{class:"failure-message"},"Generation failed. You can debug the parameters and try generating again. Generation failure will not consume credits.",-1)])])):m.value&&(!c.value||c.value.status===1)?(p(),d("div",Ke,[...e[20]||(e[20]=[a("i",{class:"fas fa-spinner fa-spin detail-spinner"},null,-1),a("p",null,"Generating...",-1)])])):m.value?(p(),d("div",Qe,[...e[21]||(e[21]=[a("p",null,"No output images",-1)])])):!m.value&&b.value.length>0?(p(),d("div",Xe,[(p(!0),d(V,null,B(b.value,(t,l)=>(p(),d("div",{key:l,class:"image-item"},[a("div",Ze,[a("img",{src:t.url,alt:`Generated image ${l+1}`},null,8,ea),a("div",aa,[a("button",{onClick:u=>q(t),class:"action-btn"},[...e[22]||(e[22]=[a("i",{class:"fas fa-download"},null,-1)])],8,sa),a("button",{onClick:u=>F(t),class:"action-btn"},[...e[23]||(e[23]=[a("i",{class:"fas fa-copy"},null,-1)])],8,ta)])]),a("div",ia,[a("span",oa,h(t.size),1),a("span",na,h(t.timestamp),1)])]))),128))])):m.value?$("",!0):(p(),d("div",la,[...e[24]||(e[24]=[P('<div class="empty-icon" data-v-365c3161><i class="fas fa-image" data-v-365c3161></i></div><h3 data-v-365c3161>Waiting for Image Generation</h3><p data-v-365c3161>Configure parameters and click the &quot;Generate Image&quot; button to start creating your AI image</p><div class="empty-features" data-v-365c3161><div class="feature-item" data-v-365c3161><i class="fas fa-palette" data-v-365c3161></i><span data-v-365c3161>Multiple Aspect Ratios</span></div><div class="feature-item" data-v-365c3161><i class="fas fa-upload" data-v-365c3161></i><span data-v-365c3161>Support Image Upload</span></div><div class="feature-item" data-v-365c3161><i class="fas fa-magic" data-v-365c3161></i><span data-v-365c3161>Intelligent Prompt Enhancement</span></div><div class="feature-item" data-v-365c3161><i class="fas fa-shield-alt" data-v-365c3161></i><span data-v-365c3161>Fallback Mechanism</span></div></div>',4)])]))])])]),e[26]||(e[26]=P('<div class="usage-tips" data-v-365c3161><div class="tip-item" data-v-365c3161><span class="tip-icon" data-v-365c3161>âœ¨</span><span data-v-365c3161>Provide detailed descriptive prompts for better results</span></div><div class="tip-item" data-v-365c3161><span class="tip-icon" data-v-365c3161>ğŸ–¼ï¸</span><span data-v-365c3161>Upload reference images to guide generation direction</span></div><div class="tip-item" data-v-365c3161><span class="tip-icon" data-v-365c3161>ğŸ“</span><span data-v-365c3161>Support multiple aspect ratios, choose the appropriate ratio</span></div><div class="tip-item" data-v-365c3161><span class="tip-icon" data-v-365c3161>ğŸ”„</span><span data-v-365c3161>Enable the fallback mechanism to improve generation success rate</span></div></div>',1))]))}},ga=oe(ra,[["__scopeId","data-v-365c3161"]]);export{ga as G};
