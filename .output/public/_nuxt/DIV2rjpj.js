import{H as le,_ as de,E as ue,D as me,p as pe,A as ve,J as ce,r as g,k as U,z as O,c as r,o as i,a as t,n as v,l as c,f as P,v as F,t as b,b as fe,d as y,K as ge,F as V,j as I,s as be,g as E,i as ye}from"./C0Gp0dND.js";import{U as ke}from"./Bunlb4cZ.js";import{u as he}from"./BDUmhOtL.js";import{u as _e}from"./CGGC2AfW.js";import{u as we}from"./hrq1PKX5.js";import{u as xe}from"./xQwj1BY5.js";const Ae=le("/tools-logo/sora.png"),Se={class:"sora-tool"},Ue={class:"mode-tabs"},Ce={class:"main-content"},Re={class:"config-panel"},$e=["disabled"],Me={key:0,class:"form-group"},Pe={class:"char-count"},Te={key:1,class:"form-group"},ze={key:0,class:"form-hint"},Fe={key:2,class:"form-group"},Ve={class:"tab-group"},Ie={class:"tab-options"},Ee={key:3,class:"form-group"},je={class:"tab-group"},Le={class:"tab-options"},Ne={key:0,class:"form-help"},Be={key:4,class:"form-group"},qe={class:"tab-group"},De={class:"tab-options"},Ge={key:5,class:"form-group"},We={class:"tab-group"},Oe={class:"tab-options"},Je={key:6,class:"form-group"},He={class:"select-wrapper"},Ke=["disabled"],Qe=["value"],Xe={key:7,class:"form-group"},Ye={class:"shots-list"},Ze={class:"shot-title"},et=["onUpdate:modelValue"],tt={class:"shot-footer"},ot={class:"duration-input"},st=["onUpdate:modelValue"],at=["onClick"],rt={key:0,class:"duration-warning error"},it={key:1,class:"duration-warning info"},nt={class:"form-actions"},lt=["disabled"],dt={key:0,class:"fas fa-spinner fa-spin"},ut={key:1,class:"fas fa-play"},mt={key:2,class:"price-tag"},pt={class:"result-panel"},vt={class:"video-header"},ct={key:0,class:"video-actions"},ft={class:"video-container"},gt={key:0,class:"video-showcase"},bt={class:"payload-json"},yt={key:1,class:"empty-state"},kt={__name:"SoraTool",setup(ht){const j=ue(),J=me(),H=typeof window<"u",{token:C}=pe(),{showError:A}=he(),{post:R}=_e(),{fetchPrices:K,getPrice:_,formatCredits:Q}=we(),{pollRecordDetail:X}=xe();ve(()=>{K()});const Y=()=>{if(!H)return null;try{return C!=null&&C.value?C.value:localStorage.getItem("auth_token")}catch{return localStorage.getItem("auth_token")}},Z=async a=>{var M,h,W;if(!a||(Array.isArray(a)?a.length===0:!a))return[];const e=Array.isArray(a)?a:[a],s=new FormData;e.forEach(l=>s.append("file",l));const u={Accept:"application/json"},d=Y();d&&(u.Authorization=`Bearer ${d}`);const m=await fetch("/api/common/batch-upload",{method:"POST",headers:u,body:s,credentials:"include"});if(!m.ok){const l=await m.json().catch(()=>({})),ne=typeof(l==null?void 0:l.errorMessage)=="string"&&((M=l.errorMessage)!=null&&M.trim())?l.errorMessage.trim():typeof(l==null?void 0:l.message)=="string"&&((h=l.message)!=null&&h.trim())?l.message.trim():(l==null?void 0:l.userTip)||(l==null?void 0:l.error)||(l==null?void 0:l.message)||"Upload failed";throw new Error(ne)}const n=await m.json(),p=((W=n==null?void 0:n.data)==null?void 0:W.urls)||(n==null?void 0:n.fileUrls)||(Array.isArray(n==null?void 0:n.data)?n.data:[]);if(!Array.isArray(p))throw new Error("Invalid response: file URLs not found");return p},o=ce({model:"text-to-video",callBackUrl:"",input:{prompt:"",aspect_ratio:"portrait",n_frames:"10",remove_watermark:!1,image_urls:[],size:"standard",video_url:""}}),L=g(null);g("");const S=g([]),$=g(!1),T=g(!1),f=g([{id:Date.now(),scene:"",duration:"7.5"}]),z=U(()=>f.value.reduce((a,e)=>a+(parseFloat(e.duration)||0),0)),N=U(()=>Number(o.input.n_frames||0)),B=U(()=>{const a=N.value-z.value;return a>0?a:0}),w=g(!1);let k=g([]);g("");const q=U(()=>{const a=o.model,e=Number(o.input.n_frames)||10;let s=null;a==="watermark-remover"?s=_("sora-watermark-remover"):a==="pro-storyboard"?s=_("sora-2-pro-storyboard",{duration:e,scene:"generate"}):a==="text-to-video"?s=_("sora-2-text-to-video"):a==="image-to-video"?s=_("sora-2-image-to-video"):a==="pro-text-to-video"?s=_("sora-2-pro-text-to-video",{duration:e,size:o.input.size||"standard"}):a==="pro-image-to-video"&&(s=_("sora-2-pro-image-to-video",{duration:e,size:o.input.size||"standard"}));const u=Q(s);return u?`(${u})`:""}),ee=async a=>{var s,u;if(!a||Array.isArray(a)&&a.length===0){o.input.image_urls=[];return}const e=Array.isArray(a)?a:[a];T.value=!0;try{o.input.image_urls=await Z(e)}catch(d){A(d.message||"Failed to upload images"),o.input.image_urls=[],(u=(s=L.value)==null?void 0:s.clearFiles)==null||u.call(s)}finally{T.value=!1}},D={"text-to-video":"/home/sora/text-to-video","image-to-video":"/home/sora/image-to-video","pro-text-to-video":"/home/sora/pro-text-to-video","pro-image-to-video":"/home/sora/pro-image-to-video","watermark-remover":"/home/sora/watermark-remover","pro-storyboard":"/home/sora/pro-storyboard"},te={"/home/sora/text-to-video":"text-to-video","/home/sora/image-to-video":"image-to-video","/home/sora/pro-text-to-video":"pro-text-to-video","/home/sora/pro-image-to-video":"pro-image-to-video","/home/sora/watermark-remover":"watermark-remover","/home/sora/pro-storyboard":"pro-storyboard"};O(()=>j.path,a=>{const e=te[a];e&&o.model!==e&&(o.model=e)},{immediate:!0});const x=a=>{o.model=a;const e=D[a]||D["text-to-video"];J.push({path:e,query:{...j.query}})},oe=async()=>{if(!$.value){$.value=!0;try{const a=await fetch("/api/sora/video-list");if(a.ok){const e=await a.json();S.value=Array.isArray(e)?e:e.list||e.videos||[]}else console.error("Failed to fetch video list"),S.value=[]}catch(a){console.error("Error fetching video list:",a),S.value=[]}finally{$.value=!1}}};O(()=>o.model,a=>{a==="watermark-remover"&&S.value.length===0&&oe()},{immediate:!0});const G=U(()=>{if(o.model==="watermark-remover")return!!o.input.video_url&&o.input.video_url.trim()!=="";if(o.model==="pro-storyboard"){if(!o.input.n_frames||!Array.isArray(f.value)||f.value.length===0)return!1;const a=N.value-z.value;return Math.abs(a)<.01}return o.input.prompt.trim()?["image-to-video","pro-image-to-video"].includes(o.model)?Array.isArray(o.input.image_urls)&&o.input.image_urls.length>0:!0:!1}),se={"text-to-video":"sora-2-text-to-video","image-to-video":"sora-2-image-to-video","pro-text-to-video":"sora-2-pro-text-to-video","pro-image-to-video":"sora-2-pro-image-to-video","watermark-remover":"sora-watermark-remover","pro-storyboard":"sora-2-pro-storyboard"},ae=()=>{f.value.push({id:Date.now()+Math.random(),scene:"",duration:"7.5"})},re=a=>{f.value.length<=1||f.value.splice(a,1)},ie=async()=>{var e,s,u;if(!G.value)return;const a=(e=o.input.prompt)==null?void 0:e.trim();if(!["watermark-remover","pro-storyboard"].includes(o.model)&&(!a||a.length>1e4)){A("Prompt is required and cannot exceed 10000 characters");return}w.value=!0;try{const d=se[o.model];let m;if(o.model==="watermark-remover"){const p=(s=o.input.video_url)==null?void 0:s.trim();if(!p){A("Video URL is required");return}m=await R("/api/video/sora/watermark-remover",{model:d,videoUrl:p})}else if(o.model==="pro-storyboard"){const p=f.value.map(h=>({duration:Number(h.duration)||0,scene:String(h.scene||"").trim()}));if(p.some(h=>!h.scene)){A("Each shot must have a scene description");return}const M={model:d,nFrames:String(o.input.n_frames||"10"),aspectRatio:o.input.aspect_ratio||"portrait",shots:p,imageUrls:o.input.image_urls&&o.input.image_urls.length>0?o.input.image_urls:void 0,callBackUrl:((u=o.callBackUrl)==null?void 0:u.trim())||void 0};m=await R("/api/video/sora-pro/storyboard",M)}else if(["pro-text-to-video","pro-image-to-video"].includes(o.model)){const p={model:d,prompt:a,imageUrls:o.input.image_urls&&o.input.image_urls.length>0?o.input.image_urls:void 0,aspectRatio:o.input.aspect_ratio||"portrait",nFrames:String(o.input.n_frames||"10"),size:o.input.size||"standard",removeWatermark:!!o.input.remove_watermark};m=await R("/api/video/sora-pro/generate",p)}else{const p={model:d,prompt:a,imageUrls:o.input.image_urls&&o.input.image_urls.length>0?o.input.image_urls:void 0,aspectRatio:o.input.aspect_ratio||"portrait",nFrames:String(o.input.n_frames||"10"),removeWatermark:!!o.input.remove_watermark};m=await R("/api/video/sora/generate",p)}let n=(m==null?void 0:m.data)??m;if(m!=null&&m.recordId&&!(Array.isArray(n==null?void 0:n.outputUrls)&&n.outputUrls.length)){const p=await X(m.recordId);n=typeof n=="object"?{...n,...p}:p}k.value.unshift(typeof n=="object"?n:{raw:n})}catch(d){console.error(d),A((d==null?void 0:d.message)||"Request failed")}finally{w.value=!1}};return(a,e)=>(i(),r("div",Se,[e[47]||(e[47]=t("div",{class:"tool-header"},[t("div",{class:"tool-avatar"},[t("img",{src:Ae,alt:"Sora"})]),t("div",{class:"tool-details"},[t("h3",null,"Sora"),t("p",null,"Sora 2 is OpenAI’s latest AI video generation model, supporting both text-to-video and image-to-video. It delivers realistic motion, physics consistency, with improved control over style, scene, and aspect ratio—ideal for creative apps and social media content.")])],-1)),t("div",Ue,[t("div",{class:v(["mode-tab",{active:o.model==="text-to-video"}]),onClick:e[0]||(e[0]=s=>x("text-to-video"))},[...e[18]||(e[18]=[t("i",{class:"fas fa-keyboard"},null,-1),t("span",null,"text-to-video",-1)])],2),t("div",{class:v(["mode-tab",{active:o.model==="image-to-video"}]),onClick:e[1]||(e[1]=s=>x("image-to-video"))},[...e[19]||(e[19]=[t("i",{class:"fas fa-image"},null,-1),t("span",null,"image-to-video",-1)])],2),t("div",{class:v(["mode-tab",{active:o.model==="pro-text-to-video"}]),onClick:e[2]||(e[2]=s=>x("pro-text-to-video"))},[...e[20]||(e[20]=[t("i",{class:"fas fa-magic"},null,-1),t("span",null,"pro-text-to-video",-1)])],2),t("div",{class:v(["mode-tab",{active:o.model==="pro-image-to-video"}]),onClick:e[3]||(e[3]=s=>x("pro-image-to-video"))},[...e[21]||(e[21]=[t("i",{class:"fas fa-wand-magic-sparkles"},null,-1),t("span",null,"pro-image-to-video",-1)])],2),t("div",{class:v(["mode-tab",{active:o.model==="watermark-remover"}]),onClick:e[4]||(e[4]=s=>x("watermark-remover"))},[...e[22]||(e[22]=[t("i",{class:"fas fa-water"},null,-1),t("span",null,"watermark-remover",-1)])],2),t("div",{class:v(["mode-tab",{active:o.model==="pro-storyboard"}]),onClick:e[5]||(e[5]=s=>x("pro-storyboard"))},[...e[23]||(e[23]=[t("i",{class:"fas fa-book"},null,-1),t("span",null,"pro-storyboard",-1)])],2)]),t("div",Ce,[t("div",Re,[e[43]||(e[43]=t("div",{class:"config-header"},[t("h4",null,"Sora Configuration")],-1)),t("fieldset",{class:"config-fieldset",disabled:w.value},[["watermark-remover","pro-storyboard"].includes(o.model)?c("",!0):(i(),r("div",Me,[e[24]||(e[24]=t("label",{for:"prompt"},"Prompt *",-1)),P(t("textarea",{id:"prompt","onUpdate:modelValue":e[6]||(e[6]=s=>o.input.prompt=s),rows:"5",maxlength:"10000",placeholder:"The text prompt describing the desired video motion",required:""},null,512),[[F,o.input.prompt]]),t("div",Pe,b(o.input.prompt.length)+"/10000",1)])),["image-to-video","pro-image-to-video","pro-storyboard"].includes(o.model)?(i(),r("div",Te,[e[25]||(e[25]=t("label",null,"Reference Images *",-1)),T.value?(i(),r("span",ze,"Uploading images...")):c("",!0),fe(ke,{ref_key:"imageUploadRef",ref:L,"input-id":"sora-image-upload",label:"","upload-icon":"fas fa-cloud-upload-alt","upload-text":"Click to upload image","upload-hint":"Supports JPG/PNG/WEBP, up to 3 images, max 10MB each","theme-color":"#3b82f6","max-files":3,"max-file-size":10*1024*1024,accept:"image/*",multiple:!0,"onUpdate:files":ee},null,512)])):c("",!0),o.model!=="watermark-remover"?(i(),r("div",Fe,[e[26]||(e[26]=t("label",null,"Aspect Ratio",-1)),t("div",Ve,[t("div",Ie,[t("button",{type:"button",class:v(["tab-option",{active:o.input.aspect_ratio==="portrait"}]),onClick:e[7]||(e[7]=s=>o.input.aspect_ratio="portrait")}," portrait ",2),t("button",{type:"button",class:v(["tab-option",{active:o.input.aspect_ratio==="landscape"}]),onClick:e[8]||(e[8]=s=>o.input.aspect_ratio="landscape")}," landscape ",2)])]),e[27]||(e[27]=t("div",{class:"form-help"},"Defines the generated video's aspect ratio.",-1))])):c("",!0),o.model!=="watermark-remover"?(i(),r("div",Ee,[e[28]||(e[28]=t("label",null,"Frames",-1)),t("div",je,[t("div",Le,[t("button",{type:"button",class:v(["tab-option",{active:o.input.n_frames==="10"}]),onClick:e[9]||(e[9]=s=>o.input.n_frames="10")}," 10s ",2),t("button",{type:"button",class:v(["tab-option",{active:o.input.n_frames==="15"}]),onClick:e[10]||(e[10]=s=>o.input.n_frames="15")}," 15s ",2),o.model==="pro-storyboard"?(i(),r("button",{key:0,type:"button",class:v(["tab-option",{active:o.input.n_frames==="25"}]),onClick:e[11]||(e[11]=s=>o.input.n_frames="25")}," 25s ",2)):c("",!0)])]),o.model==="pro-storyboard"?(i(),r("div",Ne,"Frames is required for storyboard.")):c("",!0)])):c("",!0),["pro-text-to-video","pro-image-to-video"].includes(o.model)?(i(),r("div",Be,[e[29]||(e[29]=t("label",null,"Size",-1)),t("div",qe,[t("div",De,[t("button",{type:"button",class:v(["tab-option",{active:o.input.size==="standard"}]),onClick:e[12]||(e[12]=s=>o.input.size="standard")}," standard ",2),t("button",{type:"button",class:v(["tab-option",{active:o.input.size==="high"}]),onClick:e[13]||(e[13]=s=>o.input.size="high")}," high ",2)])])])):c("",!0),["watermark-remover","pro-storyboard"].includes(o.model)?c("",!0):(i(),r("div",Ge,[e[32]||(e[32]=t("label",null,"Remove Watermark",-1)),t("div",We,[t("div",Oe,[t("button",{type:"button",class:v(["tab-option",{active:o.input.remove_watermark===!0}]),onClick:e[14]||(e[14]=s=>o.input.remove_watermark=!0)},[...e[30]||(e[30]=[t("i",{class:"fas fa-check"},null,-1),y(" true ",-1)])],2),t("button",{type:"button",class:v(["tab-option",{active:o.input.remove_watermark===!1}]),onClick:e[15]||(e[15]=s=>o.input.remove_watermark=!1)},[...e[31]||(e[31]=[t("i",{class:"fas fa-times"},null,-1),y(" false ",-1)])],2)])])])),o.model==="watermark-remover"?(i(),r("div",Je,[e[35]||(e[35]=t("label",{class:"form-label"},[y("Video Url "),t("span",{class:"required"},"*")],-1)),t("div",He,[P(t("select",{"onUpdate:modelValue":e[16]||(e[16]=s=>o.input.video_url=s),class:"form-select",disabled:$.value},[e[33]||(e[33]=t("option",{value:""},"Please select a video",-1)),(i(!0),r(V,null,I(S.value,s=>(i(),r("option",{key:s.value||s.url||s.id,value:s.value||s.url||s.id},b(s.label||s.name||s.title||s.url),9,Qe))),128))],8,Ke),[[ge,o.input.video_url]]),e[34]||(e[34]=t("i",{class:"fas fa-chevron-down"},null,-1))]),e[36]||(e[36]=t("div",{class:"form-help"},"Select a video URL from the list",-1))])):c("",!0),o.model==="pro-storyboard"?(i(),r("div",Xe,[t("label",null,"shots (Total Duration: "+b(o.input.n_frames||"?")+"s)",1),t("div",Ye,[(i(!0),r(V,null,I(f.value,(s,u)=>(i(),r("div",{class:"shot-card",key:s.id},[t("div",Ze,"Scene "+b(u+1),1),P(t("textarea",{class:"shot-text","onUpdate:modelValue":d=>s.scene=d,rows:"3",placeholder:"Describe this scene... who, where, what happens?"},null,8,et),[[F,s.scene]]),t("div",tt,[t("div",ot,[P(t("input",{class:"duration-field",type:"text","onUpdate:modelValue":d=>s.duration=d},null,8,st),[[F,s.duration]]),e[37]||(e[37]=t("span",{class:"duration-s"},"s",-1))]),f.value.length>1?(i(),r("button",{key:0,type:"button",class:"shot-delete",onClick:d=>re(u),title:"Delete scene"},[...e[38]||(e[38]=[t("i",{class:"fas fa-trash"},null,-1)])],8,at)):c("",!0)])]))),128)),t("button",{type:"button",class:"add-shot",onClick:ae},[...e[39]||(e[39]=[t("i",{class:"fas fa-plus"},null,-1),y(" Add Scene ",-1)])])]),o.input.n_frames&&z.value>Number(o.input.n_frames)?(i(),r("div",rt,[...e[40]||(e[40]=[t("i",{class:"fas fa-exclamation-triangle"},null,-1),y(" Total scene duration exceeds maximum limit, please adjust each scene duration ",-1)])])):o.input.n_frames&&B.value>0?(i(),r("div",it,[e[41]||(e[41]=t("i",{class:"fas fa-exclamation-triangle"},null,-1)),y(" Please allocate all remaining duration ("+b(B.value.toFixed(2))+"s) to scenes before generating ",1)])):c("",!0),e[42]||(e[42]=t("div",{class:"form-help"},"Add one or more scenes. Each scene includes a textual description and its duration in seconds.",-1))])):c("",!0),t("div",nt,[t("button",{class:"btn-primary",disabled:!G.value||w.value,onClick:be(ie,["prevent"])},[w.value?(i(),r("i",dt)):(i(),r("i",ut)),y(" "+b(w.value?"Submitting...":"Start Generation")+" ",1),q.value?(i(),r("span",mt,b(q.value),1)):c("",!0)],8,lt)])],8,$e)]),t("div",pt,[t("div",vt,[e[45]||(e[45]=t("h4",null,"Result Preview",-1)),E(k).length>0?(i(),r("div",ct,[t("button",{onClick:e[17]||(e[17]=s=>ye(k)?k.value=[]:k=[]),class:"btn-secondary"},[...e[44]||(e[44]=[t("i",{class:"fas fa-trash"},null,-1),y(" Clear ",-1)])])])):c("",!0)]),t("div",ft,[E(k).length>0?(i(),r("div",gt,[(i(!0),r(V,null,I(E(k),(s,u)=>(i(),r("div",{key:u,class:"video-showcase-item"},[t("pre",bt,b(typeof s=="object"?JSON.stringify(s,null,2):s),1)]))),128))])):(i(),r("div",yt,[...e[46]||(e[46]=[t("div",{class:"empty-icon"},[t("i",{class:"fas fa-film"})],-1),t("h3",null,"Waiting for Generation",-1),t("p",null,"Configure parameters, then click Start Generation.",-1)])]))])])])]))}},Ct=de(kt,[["__scopeId","data-v-596c9a1a"]]);export{Ct as S};
